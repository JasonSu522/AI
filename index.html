<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Life Manager Pro - Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        body { background-color: #f1f5f9; font-family: -apple-system, system-ui, sans-serif; -webkit-font-smoothing: antialiased; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .tab-active { color: #2563eb; position: relative; font-weight: 800; }
        .tab-active::after { content: ''; position: absolute; bottom: -8px; left: 20%; width: 60%; height: 4px; background: #2563eb; border-radius: 10px; }
        .card-glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Firebase 配置 (已填入金鑰) ---
        const firebaseConfig = {
            apiKey: "AIzaSyAky6gF4ekVOuL0JiCr8ayBpD83wrLqe28",
            authDomain: "ai-jasonsu.firebaseapp.com",
            projectId: "ai-jasonsu",
            storageBucket: "ai-jasonsu.firebasestorage.app",
            messagingSenderId: "1061478494042",
            appId: "1:1061478494042:ios:9cd580ffa5fcec98eecd63"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = 'life-manager-pro';

        const Icon = ({ name, className = "w-5 h-5" }) => {
            useEffect(() => { if(window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        function App() {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [loading, setLoading] = useState(true);
            
            // 100% 原版數據狀態
            const [assets, setAssets] = useState([]);
            const [plans, setPlans] = useState({ yearly: [], daily: [] });
            const [health, setHealth] = useState({ logs: [], exercise: [] });
            const [notes, setNotes] = useState({ life: [], book: [], trading: [], web: [] });
            const [travel, setTravel] = useState([]);

            useEffect(() => {
                auth.signInAnonymously();
                const unsubscribe = auth.onAuthStateChanged(u => setUser(u));
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;
                const uid = user.uid;
                const getCol = (name) => db.collection('artifacts').doc(appId).collection('users').doc(uid).collection(name);

                const unsubs = [
                    getCol('assets').onSnapshot(s => setAssets(s.docs.map(d => ({id:d.id, ...d.data()})))),
                    getCol('plans_yearly').onSnapshot(s => setPlans(p => ({...p, yearly: s.docs.map(d => ({id:d.id, ...d.data()}))}))),
                    getCol('plans_daily').onSnapshot(s => setPlans(p => ({...p, daily: s.docs.map(d => ({id:d.id, ...d.data()}))}))),
                    getCol('health_logs').onSnapshot(s => setHealth(h => ({...h, logs: s.docs.map(d => ({id:d.id, ...d.data()}))}))),
                    getCol('health_exercise').onSnapshot(s => setHealth(h => ({...h, exercise: s.docs.map(d => ({id:d.id, ...d.data()}))}))),
                    getCol('notes_life').onSnapshot(s => setNotes(n => ({...n, life: s.docs.map(d => ({id:d.id, ...d.data()}))}))),
                    getCol('notes_book').onSnapshot(s => setNotes(n => ({...n, book: s.docs.map(d => ({id:d.id, ...d.data()}))}))),
                    getCol('notes_trading').onSnapshot(s => setNotes(n => ({...n, trading: s.docs.map(d => ({id:d.id, ...d.data()}))}))),
                    getCol('notes_web').onSnapshot(s => setNotes(n => ({...n, web: s.docs.map(d => ({id:d.id, ...d.data()}))}))),
                    getCol('travel').onSnapshot(s => setTravel(s.docs.map(d => ({id:d.id, ...d.data()}))))
                ];
                setLoading(false);
                return () => unsubs.forEach(u => u());
            }, [user]);

            const totalValue = useMemo(() => assets.reduce((s, a) => s + Number(a.amount || 0), 0), [assets]);

            if (!user) return <div className="flex h-screen items-center justify-center font-black text-blue-600 animate-pulse">SYSTEM LOADING...</div>;

            return (
                <div className="max-w-md mx-auto min-h-screen bg-slate-50 flex flex-col relative shadow-2xl">
                    {/* Header */}
                    <header className="p-5 bg-white border-b flex justify-between items-center sticky top-0 z-30">
                        <div className="flex items-center gap-3">
                            <div className="bg-blue-600 p-2 rounded-2xl shadow-lg shadow-blue-200">
                                <Icon name="zap" className="text-white w-6 h-6" />
                            </div>
                            <h1 className="text-2xl font-black tracking-tighter text-slate-800">LifePro</h1>
                        </div>
                        <div className="flex gap-3">
                            <Icon name="search" className="text-slate-400" />
                            <Icon name="settings" className="text-slate-400" />
                        </div>
                    </header>

                    {/* Scrollable Content */}
                    <main className="flex-1 overflow-y-auto no-scrollbar p-5 pb-32">
                        
                        {/* 儀表板：資產與緊急預備金 */}
                        {activeTab === 'dashboard' && (
                            <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4">
                                <section className="bg-slate-900 rounded-[2.5rem] p-7 text-white shadow-2xl relative overflow-hidden">
                                    <p className="text-slate-400 text-xs font-bold uppercase tracking-widest mb-2">Net Worth</p>
                                    <h2 className="text-4xl font-black mb-6">${totalValue.toLocaleString()}</h2>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="bg-white/10 p-4 rounded-3xl">
                                            <p className="text-[10px] text-slate-400 uppercase">Emergency Fund</p>
                                            <p className="text-lg font-bold text-emerald-400">$600,000</p>
                                        </div>
                                        <div className="bg-white/10 p-4 rounded-3xl">
                                            <p className="text-[10px] text-slate-400 uppercase">Assets Count</p>
                                            <p className="text-lg font-bold text-blue-400">{assets.length} Items</p>
                                        </div>
                                    </div>
                                    <div className="absolute top-[-20%] right-[-10%] w-32 h-32 bg-blue-600 rounded-full blur-[80px] opacity-30"></div>
                                </section>

                                <section>
                                    <div className="flex justify-between items-end mb-4">
                                        <h3 className="text-xl font-black text-slate-800">Portfolio</h3>
                                        <span className="text-blue-600 text-xs font-bold">Details</span>
                                    </div>
                                    <div className="space-y-3">
                                        {assets.map(a => (
                                            <div key={a.id} className="card-glass p-5 rounded-[2rem] flex justify-between items-center shadow-sm">
                                                <div className="flex items-center gap-4">
                                                    <div className="w-12 h-12 bg-blue-100 rounded-2xl flex items-center justify-center text-blue-600 font-bold">
                                                        {a.category?.[0] || '資'}
                                                    </div>
                                                    <div>
                                                        <p className="font-extrabold text-slate-700">{a.name}</p>
                                                        <p className="text-[10px] font-bold text-slate-400 uppercase">{a.category}</p>
                                                    </div>
                                                </div>
                                                <p className="text-lg font-black text-slate-800">${Number(a.amount).toLocaleString()}</p>
                                            </div>
                                        ))}
                                    </div>
                                </section>
                            </div>
                        )}

                        {/* 計畫：年度與每日 */}
                        {activeTab === 'plans' && (
                            <div className="space-y-6">
                                <h3 className="text-2xl font-black">Strategic Plans</h3>
                                <div className="space-y-4">
                                    <div className="p-6 bg-white rounded-[2rem] border-2 border-slate-100">
                                        <h4 className="font-black text-blue-600 mb-4 flex items-center gap-2">
                                            <Icon name="target" /> Yearly Goals
                                        </h4>
                                        {plans.yearly.map(p => (
                                            <div key={p.id} className="flex items-center gap-3 py-2 border-b border-slate-50 last:border-0">
                                                <div className="w-2 h-2 rounded-full bg-blue-600"></div>
                                                <span className="font-bold text-slate-600">{p.title}</span>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="p-6 bg-white rounded-[2rem] border-2 border-slate-100 shadow-sm">
                                        <h4 className="font-black text-orange-500 mb-4 flex items-center gap-2">
                                            <Icon name="check-square" /> Daily Rituals
                                        </h4>
                                        {plans.daily.map(p => (
                                            <div key={p.id} className="flex items-center gap-4 py-3 border-b border-slate-50 last:border-0">
                                                <Icon name={p.completed ? "check-circle" : "circle"} className={p.completed ? "text-green-500" : "text-slate-200"} />
                                                <span className={`font-bold ${p.completed ? 'line-through text-slate-300' : 'text-slate-600'}`}>{p.title}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* 筆記與旅遊 */}
                        {activeTab === 'notes' && (
                            <div className="space-y-6">
                                <h3 className="text-2xl font-black">Knowledge Base</h3>
                                <div className="grid grid-cols-2 gap-4">
                                    {['life', 'book', 'trading', 'web'].map(cat => (
                                        <div key={cat} className="p-5 bg-white rounded-[2rem] border border-slate-100 shadow-sm">
                                            <Icon name="bookmark" className="text-blue-500 mb-3" />
                                            <p className="font-black capitalize text-slate-700">{cat}</p>
                                            <p className="text-[10px] font-bold text-slate-400">{notes[cat]?.length || 0} NOTES</p>
                                        </div>
                                    ))}
                                </div>
                                <div className="p-6 bg-indigo-600 rounded-[2.5rem] text-white shadow-xl">
                                    <h4 className="font-black mb-3 flex items-center gap-2"><Icon name="plane" /> Travel Plans</h4>
                                    {travel.map(t => <div key={t.id} className="text-sm font-bold opacity-90 py-1">• {t.destination} ({t.date})</div>)}
                                </div>
                            </div>
                        )}

                        {/* 健康日誌 */}
                        {activeTab === 'health' && (
                            <div className="space-y-6">
                                <h3 className="text-2xl font-black text-slate-800">Health Core</h3>
                                <div className="bg-red-500 p-7 rounded-[2.5rem] text-white shadow-xl flex justify-between items-center">
                                    <div>
                                        <p className="text-xs font-bold opacity-80 uppercase tracking-widest">Weight (Latest)</p>
                                        <h4 className="text-4xl font-black mt-1">72.5 <span className="text-lg opacity-60">kg</span></h4>
                                    </div>
                                    <Icon name="heart" className="w-12 h-12 opacity-20" />
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="p-5 bg-white rounded-[2rem] border border-slate-100 shadow-sm text-center">
                                        <p className="text-[10px] font-bold text-slate-400">Muscle Mass</p>
                                        <p className="text-xl font-black text-slate-700">34.2%</p>
                                    </div>
                                    <div className="p-5 bg-white rounded-[2rem] border border-slate-100 shadow-sm text-center">
                                        <p className="text-[10px] font-bold text-slate-400">Body Fat</p>
                                        <p className="text-xl font-black text-slate-700">18.5%</p>
                                    </div>
                                </div>
                                <div className="p-6 bg-white rounded-[2rem] border border-slate-100">
                                    <h4 className="font-black text-slate-700 mb-4">Workout Log</h4>
                                    {health.exercise.map(ex => (
                                        <div key={ex.id} className="flex justify-between py-3 border-b border-slate-50 last:border-0 text-sm font-bold text-slate-500">
                                            <span>{ex.content}</span>
                                            <span className="text-blue-500">{ex.duration}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Bottom Navigation */}
                    <nav className="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-2xl border-t border-slate-100 px-8 py-5 pb-10 flex justify-between items-center z-40 safe-bottom">
                        <button onClick={() => setActiveTab('dashboard')} className={activeTab === 'dashboard' ? 'tab-active' : 'text-slate-300'}>
                            <Icon name="layout-grid" className="w-7 h-7" />
                        </button>
                        <button onClick={() => setActiveTab('plans')} className={activeTab === 'plans' ? 'tab-active' : 'text-slate-300'}>
                            <Icon name="calendar-days" className="w-7 h-7" />
                        </button>
                        
                        <div className="relative">
                            <button className="bg-slate-900 text-white p-5 rounded-[2rem] -translate-y-10 shadow-2xl active:scale-90 transition-all">
                                <Icon name="plus" className="w-8 h-8" />
                            </button>
                        </div>

                        <button onClick={() => setActiveTab('notes')} className={activeTab === 'notes' ? 'tab-active' : 'text-slate-300'}>
                            <Icon name="folder-kanban" className="w-7 h-7" />
                        </button>
                        <button onClick={() => setActiveTab('health')} className={activeTab === 'health' ? 'tab-active' : 'text-slate-300'}>
                            <Icon name="heart-pulse" className="w-7 h-7" />
                        </button>
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
