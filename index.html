<!DOCTYPE html>

<html lang="zh-TW">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>人生管理 | Life Manager Pro</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{background:#020617;color:#e2e8f0;font-family:-apple-system,BlinkMacSystemFont,'Helvetica Neue',Arial,sans-serif;min-height:100vh;font-size:15px;}
.app{display:flex;min-height:100vh;}
.sidebar{position:fixed;left:0;top:0;bottom:0;width:64px;background:#0f172a;border-right:1px solid #1e293b;display:flex;flex-direction:column;align-items:center;padding:20px 0;z-index:100;}
.main{margin-left:64px;padding:26px 22px;width:calc(100% - 64px);min-height:100vh;overflow-y:auto;}
.nav-btn{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:54px;border:none;background:transparent;cursor:pointer;color:#64748b;border-right:3px solid transparent;-webkit-tap-highlight-color:transparent;}
.nav-btn.act{color:#60a5fa;background:rgba(59,130,246,.12);border-right-color:#3b82f6;}
.nav-btn svg{width:20px;height:20px;pointer-events:none;}
.nlabel{font-size:9px;margin-top:4px;font-weight:900;text-transform:uppercase;letter-spacing:.05em;pointer-events:none;}
.page{display:none;flex-direction:column;gap:16px;}
.page.act{display:flex;}
.card{background:#0f172a;border:1px solid #1e293b;border-radius:18px;padding:20px;}
.tcrd{background:#0f172a;border:1px solid #1e293b;border-radius:24px;padding:26px;text-align:center;}
.aib{background:linear-gradient(135deg,rgba(23,37,84,.5),#0f172a);border:1px solid rgba(59,130,246,.3);border-radius:18px;padding:18px;}
.aig{background:#0f172a;border:1px solid rgba(16,185,129,.3);border-radius:16px;padding:16px;}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.ga{display:grid;grid-template-columns:1.4fr 1fr;gap:16px;}
.sec{font-size:13px;font-weight:900;font-style:italic;text-transform:uppercase;letter-spacing:.1em;color:#94a3b8;}
.lxs{font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.14em;color:#64748b;}
.emp{color:#475569;font-size:14px;font-style:italic;text-align:center;padding:18px 0;}
.hr{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;}
.bb{background:#2563eb;color:#fff;border:none;border-radius:10px;padding:9px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;-webkit-tap-highlight-color:transparent;}
.bg{background:#059669;color:#fff;border:none;border-radius:10px;padding:9px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;-webkit-tap-highlight-color:transparent;}
.bgh{background:rgba(59,130,246,.15);color:#60a5fa;border:1px solid rgba(59,130,246,.3);border-radius:8px;padding:7px 13px;font-size:11px;font-weight:900;cursor:pointer;white-space:nowrap;-webkit-tap-highlight-color:transparent;}
.bgg{background:rgba(16,185,129,.1);color:#34d399;border:1px solid rgba(16,185,129,.25);border-radius:8px;padding:7px 13px;font-size:11px;font-weight:900;cursor:pointer;-webkit-tap-highlight-color:transparent;}
.bd{background:none;border:none;color:#475569;cursor:pointer;padding:5px;display:inline-flex;align-items:center;-webkit-tap-highlight-color:transparent;}
.be{background:none;border:none;color:#475569;cursor:pointer;padding:5px;display:inline-flex;align-items:center;-webkit-tap-highlight-color:transparent;}
.bsb{background:none;border:none;font-size:11px;font-weight:900;text-transform:uppercase;cursor:pointer;color:#60a5fa;padding:0;-webkit-tap-highlight-color:transparent;}
.bsr{background:none;border:none;font-size:11px;font-weight:900;text-transform:uppercase;cursor:pointer;color:#ef4444;padding:0;-webkit-tap-highlight-color:transparent;}
.pb{height:5px;background:#1e293b;border-radius:9999px;overflow:hidden;margin-top:4px;}
.pf{height:100%;background:#3b82f6;border-radius:9999px;}
.pi{width:46px;text-align:center;font-size:12px;font-weight:900;color:#60a5fa;padding:3px;background:#020617;border:1px solid #334155;border-radius:6px;font-family:inherit;}
.ai{padding:12px 14px;background:rgba(30,41,59,.25);border:1px solid #1e293b;border-radius:12px;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.di{padding:12px 14px;background:rgba(30,41,59,.2);border:1px solid #1e293b;border-radius:12px;display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.nc{background:rgba(30,41,59,.2);border:1px solid #1e293b;border-radius:12px;overflow:hidden;margin-bottom:8px;}
.nh{width:100%;padding:12px 14px;display:flex;justify-content:space-between;align-items:center;background:none;border:none;color:#e2e8f0;cursor:pointer;font-size:13px;font-weight:900;font-style:italic;text-align:left;font-family:inherit;-webkit-tap-highlight-color:transparent;}
.nb{padding:14px;border-top:1px solid rgba(30,41,59,.6);background:rgba(2,6,23,.4);font-size:13px;color:#94a3b8;line-height:1.65;display:none;}
.nb.op{display:block;}
.tc{padding:15px;background:rgba(30,41,59,.2);border:1px solid #1e293b;border-radius:16px;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.ti{padding:9px;background:rgba(16,185,129,.1);border-radius:10px;color:#10b981;display:flex;}
.mw{position:fixed;inset:0;z-index:300;display:none;align-items:center;justify-content:center;padding:16px;background:rgba(0,0,0,.85);}
.mw.op{display:flex;}
.mb{position:relative;background:#0f172a;border:1px solid #1e293b;width:100%;max-width:420px;border-radius:28px;padding:32px;box-shadow:0 30px 60px rgba(0,0,0,.7);max-height:90vh;overflow-y:auto;}
.mt{font-size:18px;font-weight:900;font-style:italic;text-transform:uppercase;color:#fff;margin-bottom:22px;}
.mc{position:absolute;top:14px;right:14px;background:#1e293b;border:none;color:#64748b;cursor:pointer;width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;-webkit-tap-highlight-color:transparent;}
.fg{display:flex;flex-direction:column;gap:6px;margin-bottom:14px;}
.fg label{font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.14em;color:#64748b;}
.fg input,.fg textarea{background:#1e293b;border:1px solid #334155;border-radius:11px;padding:12px 15px;font-size:15px;color:#e2e8f0;outline:none;width:100%;font-family:inherit;-webkit-appearance:none;}
.fg textarea{height:100px;resize:vertical;}
.ms{width:100%;padding:14px;background:#2563eb;color:#fff;border:none;border-radius:12px;font-size:13px;font-weight:900;text-transform:uppercase;cursor:pointer;-webkit-tap-highlight-color:transparent;}
.vb{margin-top:auto;margin-bottom:12px;width:40px;height:40px;border-radius:50%;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;background:#1e293b;color:#94a3b8;-webkit-tap-highlight-color:transparent;}
@media(max-width:700px){
.g2,.ga{grid-template-columns:1fr;}
.main{margin-left:0;padding:14px 14px 76px;width:100%;}
.sidebar{width:100%;height:60px;top:auto;bottom:0;flex-direction:row;border-right:none;border-top:1px solid #1e293b;padding:0;justify-content:space-around;}
.nav-btn{height:60px;width:auto;border-right:none;border-top:3px solid transparent;flex:1;padding:0 4px;}
.nav-btn.act{border-top-color:#3b82f6;border-right:none;background:rgba(59,130,246,.1);}
.vb{margin:0;flex-shrink:0;}
}
</style>
</head>
<body>
<div id="ver" style="position:fixed;top:0;right:0;background:red;color:white;font-size:11px;padding:2px 6px;z-index:9999;font-family:monospace;">v10</div>
<div class="app">
<nav class="sidebar" id="SB">
  <div style="margin-bottom:20px;color:#3b82f6;flex-shrink:0;"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96-.46 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96-.46 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg></div>
  <button class="nav-btn act" data-tab="dash"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg><span class="nlabel">總覽</span></button>
  <button class="nav-btn" data-tab="plans"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="18" height="18" x="3" y="4" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class="nlabel">計畫</span></button>
  <button class="nav-btn" data-tab="health"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg><span class="nlabel">健康</span></button>
  <button class="nav-btn" data-tab="assets"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg><span class="nlabel">資產</span></button>
  <button class="nav-btn" data-tab="notes"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg><span class="nlabel">筆記</span></button>
  <button class="nav-btn" data-tab="travel"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" y1="3" x2="9" y2="18"/><line x1="15" y1="6" x2="15" y2="21"/></svg><span class="nlabel">旅遊</span></button>
  <button class="vb" id="VB"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/></svg></button>
</nav>
<main class="main" id="MA">
  <div style="margin-bottom:22px;"><h1 style="font-size:23px;font-weight:900;color:#fff;font-style:italic;text-transform:uppercase;">人生管理</h1><p class="lxs" style="margin-top:4px;">Efficiency &amp; Vision</p></div>
  <div id="pg-dash" class="page act">
    <div class="g2">
      <div class="card" style="display:flex;flex-direction:column;align-items:center;gap:12px;"><p style="font-size:11px;font-weight:900;color:#60a5fa;text-transform:uppercase;font-style:italic;">人生雷達圖</p><svg id="RSV" viewBox="0 0 200 200" style="width:100%;max-width:190px;"></svg></div>
      <div class="aib" style="display:flex;flex-direction:column;gap:11px;"><div style="display:flex;justify-content:space-between;align-items:center;"><span style="font-size:11px;font-weight:900;color:#60a5fa;text-transform:uppercase;font-style:italic;">AI 生命分析</span><button class="bgh" data-act="genAI">重新產生</button></div><p id="AIS" style="font-size:13px;color:#cbd5e1;line-height:1.7;white-space:pre-wrap;flex:1;min-height:60px;">點擊重新產生取得 AI 分析...</p></div>
    </div>
    <div class="card"><p class="sec" style="margin-bottom:13px;">年度目標進度</p><div id="DY"></div></div>
    <div class="tcrd">
      <p class="lxs">總資產市值</p><div id="DT" style="font-size:34px;font-weight:900;color:#fff;font-style:italic;margin:8px 0 20px;"></div>
      <svg id="PD" viewBox="-1.15 -1.15 2.3 2.3" style="transform:rotate(-90deg);width:100%;max-width:210px;height:auto;display:block;margin:0 auto;"></svg>
      <div id="LD" style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:13px;"></div>
      <div style="margin-top:20px;padding-top:18px;border-top:1px solid #1e293b;display:flex;justify-content:space-between;align-items:center;"><div><p class="lxs">緊急預備金</p><p id="ED" style="font-size:21px;font-weight:900;color:#60a5fa;font-style:italic;margin-top:4px;">$0</p></div><button class="bgh" data-act="editEmg">修改金額</button></div>
    </div>
  </div>
  <div id="pg-plans" class="page">
    <div class="card"><div class="hr"><span class="sec">年度目標計畫</span><button class="bb" data-act="addYearly"><svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="YL"></div></div>
    <div class="card"><div class="hr"><span class="sec">每日任務管理</span><button class="bb" data-act="addDaily"><svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="DL"></div></div>
  </div>
  <div id="pg-health" class="page">
    <div class="card"><div class="hr"><span class="sec">健康數據趨勢</span><button class="bb" data-act="addHealth"><svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="HC"></div><p class="lxs" style="margin:15px 0 9px;">歷史記錄</p><div id="HL"></div></div>
  </div>
  <div id="pg-assets" class="page">
    <div class="aig"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:9px;"><span style="font-size:11px;font-weight:900;color:#34d399;text-transform:uppercase;">AI 資產配置建議</span><button class="bgg" data-act="assetAI">開始分析</button></div><p id="AA" style="font-size:13px;color:#94a3b8;line-height:1.6;font-style:italic;">點擊開始分析，AI 將提供配置建議。</p></div>
    <div class="ga">
      <div class="tcrd" style="border-radius:22px;"><p class="lxs">總資產市值</p><div id="AT" style="font-size:26px;font-weight:900;color:#fff;font-style:italic;margin:7px 0 17px;"></div><svg id="PA" viewBox="-1.15 -1.15 2.3 2.3" style="transform:rotate(-90deg);width:100%;max-width:190px;height:auto;display:block;margin:0 auto;"></svg><div id="LA" style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:11px;"></div></div>
      <div class="card"><div class="hr"><span class="sec">資產明細</span><button class="bb" data-act="addAsset"><svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="AL"></div></div>
    </div>
  </div>
  <div id="pg-notes" class="page">
    <div class="g2">
      <div class="card"><div class="hr"><span class="lxs">人生成長</span><button class="bb" data-act="addNote-life" style="padding:7px;"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="NL-life"></div></div>
      <div class="card"><div class="hr"><span class="lxs">書籍重點</span><button class="bb" data-act="addNote-book" style="padding:7px;"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="NL-book"></div></div>
      <div class="card"><div class="hr"><span class="lxs">台指交易</span><button class="bb" data-act="addNote-trading" style="padding:7px;"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="NL-trading"></div></div>
      <div class="card"><div class="hr"><span class="lxs">網路心得</span><button class="bb" data-act="addNote-web" style="padding:7px;"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="NL-web"></div></div>
    </div>
  </div>
  <div id="pg-travel" class="page">
    <div class="card"><div class="hr"><span class="sec">旅遊願望與行程</span><button class="bg" data-act="addTravel"><svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="TL"></div></div>
  </div>
</main>
</div>
<div class="mw" id="MW">
  <div class="mb">
    <button class="mc" data-act="closeModal"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
    <div id="MT" class="mt"></div>
    <form id="MF"><div id="MFD"></div><button type="submit" class="ms">確認送出</button></form>
  </div>
</div>
<script>
var GK = 'AIzaSyAky6gF4ekVOuL0JiCr8ayBpD83wrLqe28';
var PC = ['#3b82f6','#10b981','#f59e0b','#ef4444','#8b5cf6'];
var PAGES = ['dash','plans','health','assets','notes','travel'];
var NKEYS = ['life','book','trading','web'];
var DB = {};
var RV = {wealth:50,health:50,growth:50,discipline:50,experience:50};
var aiOn = false;
var dragSrc = null;
var MM = {};

function lsGet(k) {
try { var v = localStorage.getItem(k); return v ? JSON.parse(v) : null; } catch(e) { return null; }
}
function lsSet(k, v) {
try { localStorage.setItem(k, JSON.stringify(v)); } catch(e) {}
}
function uid() {
return ‘_’ + Math.random().toString(36).slice(2) + Date.now().toString(36);
}
function esc(s) {
return String(s == null ? ‘’ : s).replace(/&/g,’&’).replace(/</g,’<’).replace(/>/g,’>’).replace(/”/g,’"’);
}
function ge(id) { return document.getElementById(id); }
function merge(a, b) {
var r = {};
var k;
for (k in a) { r[k] = a[k]; }
for (k in b) { r[k] = b[k]; }
return r;
}

DB = lsGet(‘lm10’) || {};
if (!DB.assets || !DB.assets.length) {
DB.assets = [
{id:uid(),name:’\u53f0\u80a1’,amount:2544261,category:’\u53f0\u80a1’,createdAt:Date.now()},
{id:uid(),name:’\u7f8e\u80a1’,amount:829175,category:’\u7f8e\u80a1’,createdAt:Date.now()},
{id:uid(),name:’\u53f0\u65b0\u5916\u5e63(\u6d3b)-USD’,amount:4257,category:’\u7f8e\u80a1’,createdAt:Date.now()},
{id:uid(),name:’\u53f0\u65b0\u5916\u5e63(\u6d3b)-JPY’,amount:6006,category:’\u73fe\u91d1’,createdAt:Date.now()},
{id:uid(),name:’\u53f0\u65b0\u5916\u5e63(\u5b9a)-USD’,amount:75473,category:’\u7f8e\u80a1’,createdAt:Date.now()},
{id:uid(),name:’\u5408\u5eab(\u6d3b\u5b58)’,amount:1357878,category:’\u73fe\u91d1’,createdAt:Date.now()},
{id:uid(),name:’\u53f0\u65b0(\u6d3b\u5b58)’,amount:57170,category:’\u73fe\u91d1’,createdAt:Date.now()},
{id:uid(),name:’\u5f70\u9280(\u6d3b\u5b58)’,amount:457003,category:’\u73fe\u91d1’,createdAt:Date.now()},
{id:uid(),name:’\u5146\u8c50(\u5099\u7528\u91d1)’,amount:43314,category:’\u73fe\u91d1’,createdAt:Date.now()},
{id:uid(),name:’\u9ec3\u91d1(2.2oz)’,amount:357357,category:’\u9ec3\u91d1’,createdAt:Date.now()},
{id:uid(),name:’\u53f0\u5e63\u73fe\u91d1’,amount:20000,category:’\u73fe\u91d1’,createdAt:Date.now()},
{id:uid(),name:’\u501f\u5fd7’,amount:300000,category:’\u501f\u6b3e’,createdAt:Date.now()}
];
lsSet(‘lm10’, DB);
}

function cats() {
var c = {};
c[’\u53f0\u80a1’] = 0;
c[’\u7f8e\u80a1’] = 0;
c[’\u73fe\u91d1’] = 0;
c[’\u9ec3\u91d1’] = 0;
c[’\u501f\u6b3e’] = 0;
var assets = DB.assets || [];
for (var i = 0; i < assets.length; i++) {
var a = assets[i];
var cat = a.category || ‘\u73fe\u91d1’;
if (c[cat] === undefined) { c[cat] = 0; }
c[cat] += Number(a.amount) || 0;
}
var result = [];
var keys = Object.keys(c);
for (var j = 0; j < keys.length; j++) {
result.push({name: keys[j], amt: c[keys[j]]});
}
return result;
}
function tot() {
var data = cats();
var s = 0;
for (var i = 0; i < data.length; i++) { s += data[i].amt; }
return s;
}

document.addEventListener(‘click’, function(e) {
var t = e.target;
while (t && t !== document.body) {
var tab = t.getAttribute(‘data-tab’);
if (tab) { switchTab(tab); return; }
var act = t.getAttribute(‘data-act’);
if (act) { doAct(act, t); return; }
t = t.parentElement;
}
});

document.addEventListener(‘change’, function(e) {
var t = e.target;
if (t.getAttribute(‘data-act’) === ‘prog’) {
var col = t.getAttribute(‘data-col’);
var id = t.getAttribute(‘data-id’);
var v = Math.min(100, Math.max(0, parseInt(t.value) || 0));
if (!DB[col]) { return; }
for (var i = 0; i < DB[col].length; i++) {
if (DB[col][i].id === id) { DB[col][i].progress = v; break; }
}
lsSet(‘lm10’, DB);

(function() {
var steps = [‘drawRadar’,‘drawPie-PD’,‘drawPie-PA’,‘renderDash’,‘renderYearly’,‘renderDaily’,‘renderAssets’,‘renderHealth’,‘renderNotes’,‘renderTravel’];
var done = [];
function showStep(s) {
done.push(s);
var d = document.getElementById(‘DBG’);
if (!d) {
d = document.createElement(‘div’);
d.id = ‘DBG’;
d.style.cssText = ‘position:fixed;bottom:70px;left:8px;right:8px;background:rgba(0,0,0,.9);color:#10b981;padding:10px;border-radius:10px;font-size:11px;font-family:monospace;z-index:9999;max-height:200px;overflow-y:auto;’;
document.body.appendChild(d);
}
d.textContent = done.join(’ > ’);
}
try { drawRadar(); showStep(‘radar’); } catch(e) { showStep(‘FAIL:radar:’+e.message); return; }
try { drawPie(‘PD’,‘LD’); showStep(‘pie1’); } catch(e) { showStep(‘FAIL:pie1:’+e.message); return; }
try { drawPie(‘PA’,‘LA’); showStep(‘pie2’); } catch(e) { showStep(‘FAIL:pie2:’+e.message); return; }
try { renderDash(); showStep(‘dash’); } catch(e) { showStep(‘FAIL:dash:’+e.message); return; }
try { renderYearly(); showStep(‘yearly’); } catch(e) { showStep(‘FAIL:yearly:’+e.message); return; }
try { renderDaily(); showStep(‘daily’); } catch(e) { showStep(‘FAIL:daily:’+e.message); return; }
try { renderAssets(); showStep(‘assets’); } catch(e) { showStep(‘FAIL:assets:’+e.message); return; }
try { renderHealth(); showStep(‘health’); } catch(e) { showStep(‘FAIL:health:’+e.message); return; }
try { for(var i=0;i<NKEYS.length;i++){renderNotes(NKEYS[i]);} showStep(‘notes’); } catch(e) { showStep(‘FAIL:notes:’+e.message); return; }
try { renderTravel(); showStep(‘travel’); } catch(e) { showStep(‘FAIL:travel:’+e.message); return; }
showStep(‘ALL-OK’);
})();

}
});

function switchTab(id) {
for (var i = 0; i < PAGES.length; i++) {
var pg = ge(‘pg-’ + PAGES[i]);
var nb = document.querySelector(’[data-tab=”’ + PAGES[i] + ‘”]’);
if (pg) { pg.className = (PAGES[i] === id) ? ‘page act’ : ‘page’; }
if (nb) { nb.className = (PAGES[i] === id) ? ‘nav-btn act’ : ‘nav-btn’; }
}
renderAll();
}

function doAct(act, el) {
if (act === ‘closeModal’) { closeModal(); return; }
if (act === ‘genAI’) { generateAI(); return; }
if (act === ‘assetAI’) { getAssetAI(); return; }
if (act === ‘editEmg’) {
openModal(‘emergency_fund’, ‘edit’, ‘\u4fee\u6539\u7dca\u6025\u9810\u5099\u91d1’, [{name:‘value’,label:’\u91d1\u984d’,type:‘number’}]);
return;
}
if (act === ‘addYearly’) {
openModal(‘plans_yearly’, ‘add’, ‘\u65b0\u589e\u5e74\u5ea6\u8a08\u756b’, [{name:‘title’,label:’\u76ee\u6a19\u540d\u7a31’,type:‘text’},{name:‘progress’,label:’\u76ee\u524d\u9032\u5ea6(%)’,type:‘number’}]);
return;
}
if (act === ‘addDaily’) {
openModal(‘plans_daily’, ‘add’, ‘\u65b0\u589e\u6bcf\u65e5\u4efb\u52d9’, [{name:‘title’,label:’\u4efb\u52d9\u5167\u5bb9’,type:‘text’}]);
return;
}
if (act === ‘addHealth’) {
openModal(‘health_logs’, ‘add’, ‘\u8a18\u9304\u4eca\u65e5\u6578\u64da’, [{name:‘weight’,label:’\u9ad4\u91cd(kg)’,type:‘number’},{name:‘fat’,label:’\u9ad4\u8102(%)’,type:‘number’},{name:‘muscle’,label:’\u808c\u8089\u91cf(kg)’,type:‘number’}]);
return;
}
if (act === ‘addAsset’) {
openModal(‘assets’, ‘add’, ‘\u65b0\u589e\u8cc7\u7522’, [{name:‘name’,label:’\u540d\u7a31’,type:‘text’},{name:‘amount’,label:’\u5e02\u5024\u91d1\u984d’,type:‘number’},{name:‘category’,label:’\u5206\u985e’,type:‘text’}]);
return;
}
if (act === ‘addTravel’) {
openModal(‘travel’, ‘add’, ‘\u65b0\u589e\u65c5\u904a\u884c\u7a0b’, [{name:‘destination’,label:’\u76ee\u7684\u5730’,type:‘text’},{name:‘start’,label:’\u958b\u59cb\u65e5\u671f’,type:‘date’},{name:‘end’,label:’\u7d50\u675f\u65e5\u671f’,type:‘date’}]);
return;
}
if (act.indexOf(‘addNote-’) === 0) {
var nk = act.slice(8);
openModal(‘notes_’ + nk, ‘add’, ‘\u65b0\u589e\u7b46\u8a18’, [{name:‘title’,label:’\u6a19\u984c’,type:‘text’},{name:‘content’,label:’\u5167\u5bb9’,type:‘textarea’}]);
return;
}
if (act === ‘del’) {
var col = el.getAttribute(‘data-col’);
var id = el.getAttribute(‘data-id’);
if (!DB[col]) { return; }
var newArr = [];
for (var i = 0; i < DB[col].length; i++) {
if (DB[col][i].id !== id) { newArr.push(DB[col][i]); }
}
DB[col] = newArr;
lsSet(‘lm10’, DB);
renderAll();
return;
}
if (act === ‘editAsset’) {
var id = el.getAttribute(‘data-id’);
openModal(‘assets’, ‘edit’, ‘\u7de8\u8f2f\u8cc7\u7522’, [{name:‘name’,label:’\u540d\u7a31’,type:‘text’},{name:‘amount’,label:’\u5e02\u5024\u91d1\u984d’,type:‘number’},{name:‘category’,label:’\u5206\u985e’,type:‘text’}], id);
return;
}
if (act === ‘editNote’) {
var nk = el.getAttribute(‘data-nk’);
var id = el.getAttribute(‘data-id’);
openModal(‘notes_’ + nk, ‘edit’, ‘\u7de8\u8f2f\u7b46\u8a18’, [{name:‘title’,label:’\u6a19\u984c’,type:‘text’},{name:‘content’,label:’\u5167\u5bb9’,type:‘textarea’}], id);
return;
}
if (act === ‘toggleNote’) {
var nk = el.getAttribute(‘data-nk’);
var id = el.getAttribute(‘data-id’);
var body = ge(‘nb-’ + nk + ‘-’ + id);
if (!body) { return; }
body.className = (body.className === ‘nb op’) ? ‘nb’ : ‘nb op’;
return;
}
}

ge(‘MW’).addEventListener(‘click’, function(e) {
if (e.target === this) { closeModal(); }
});

ge(‘MF’).addEventListener(‘submit’, function(e) {
e.preventDefault();
var data = {};
var inputs = ge(‘MFD’).querySelectorAll(‘input,textarea’);
for (var i = 0; i < inputs.length; i++) {
data[inputs[i].name] = inputs[i].value;
}
var col = MM.col, type = MM.type, eid = MM.eid;
if (col === ‘emergency_fund’) {
DB.emergencyFund = Number(data.value);
} else if (type === ‘edit’) {
if (DB[col]) {
for (var i = 0; i < DB[col].length; i++) {
if (DB[col][i].id === eid) { DB[col][i] = merge(DB[col][i], data); break; }
}
}
} else {
if (!DB[col]) { DB[col] = []; }
DB[col].push(merge({id:uid(), createdAt:Date.now()}, data));
}
lsSet(‘lm10’, DB);
closeModal();
renderAll();
});

ge(‘VB’).addEventListener(‘click’, function() { doVoice(); });

function openModal(col, type, title, fields, editId) {
MM = {col:col, type:type, eid:editId};
ge(‘MT’).textContent = title;
var init = {};
if (type === ‘edit’ && editId && col !== ‘emergency_fund’) {
var arr = DB[col] || [];
for (var i = 0; i < arr.length; i++) {
if (arr[i].id === editId) { init = arr[i]; break; }
}
}
if (col === ‘emergency_fund’) { init = {value: DB.emergencyFund || 0}; }
var html = ‘’;
for (var i = 0; i < fields.length; i++) {
var f = fields[i];
var v = esc(String(init[f.name] == null ? ‘’ : init[f.name]));
html += ‘<div class="fg"><label>’ + f.label + ‘</label>’;
if (f.type === ‘textarea’) {
html += ‘<textarea name="' + f.name + '">’ + v + ‘</textarea>’;
} else {
html += ‘<input name="' + f.name + '" type="' + f.type + '" step="any" value="' + v + '">’;
}
html += ‘</div>’;
}
ge(‘MFD’).innerHTML = html;
ge(‘MW’).className = ‘mw op’;
}

function closeModal() {
ge(‘MW’).className = ‘mw’;
}

function drawPie(svgId, legId) {
var svg = ge(svgId);
var leg = ge(legId);
if (!svg) { return; }
svg.innerHTML = ‘’;
var data = cats();
var total = tot();
if (!total) { return; }
var cum = 0;
function pt(p) { return [Math.cos(2 * Math.PI * p), Math.sin(2 * Math.PI * p)]; }
for (var i = 0; i < data.length; i++) {
var d = data[i];
var pct = d.amt / total;
if (pct <= 0) { continue; }
var a0 = cum;
cum += pct;
var p0 = pt(a0), p1 = pt(cum), pm = pt(a0 + pct / 2);
var large = pct > 0.5 ? 1 : 0;
var path = document.createElementNS(‘http://www.w3.org/2000/svg’, ‘path’);
path.setAttribute(‘d’, ‘M’ + p0[0] + ’ ’ + p0[1] + ’ A1 1 0 ’ + large + ’ 1 ’ + p1[0] + ’ ’ + p1[1] + ’ L0 0’);
path.setAttribute(‘fill’, PC[i % PC.length]);
path.setAttribute(‘stroke’, ‘#020617’);
path.setAttribute(‘stroke-width’, ‘0.025’);
svg.appendChild(path);
}
if (leg) {
var html = ‘’;
for (var i = 0; i < data.length; i++) {
var col = PC[i % PC.length];
html += ‘<span style="font-size:11px;font-weight:700;color:' + col + ';display:inline-flex;align-items:center;gap:4px;">’;
html += ‘<span style="width:8px;height:8px;border-radius:50%;background:' + col + ';display:inline-block;"></span>’;
html += esc(data[i].name) + ‘: $’ + Number(data[i].amt).toLocaleString() + ‘</span>’;
}
leg.innerHTML = html;
}
}

function drawRadar() {
var svg = ge(‘RSV’);
if (!svg) { return; }
svg.innerHTML = ‘’;
var K = [‘wealth’,‘health’,‘growth’,‘discipline’,‘experience’];
var L = [’\u8ca1\u52d9’,’\u5065\u5eb7’,’\u6210\u9577’,’\u81ea\u5f8b’,’\u9ad4\u9a57’];
var C = 100, R = 64;
function pt(i, v) {
var a = Math.PI * 2 * i / 5 - Math.PI / 2;
return [C + R * (v / 100) * Math.cos(a), C + R * (v / 100) * Math.sin(a)];
}
var rings = [20, 40, 60, 80, 100];
for (var r = 0; r < rings.length; r++) {
var pts = [];
for (var k = 0; k < K.length; k++) { pts.push(pt(k, rings[r]).join(’,’)); }
var poly = document.createElementNS(‘http://www.w3.org/2000/svg’, ‘polygon’);
poly.setAttribute(‘points’, pts.join(’ ‘));
poly.setAttribute(‘fill’, ‘none’);
poly.setAttribute(‘stroke’, ‘#1e293b’);
poly.setAttribute(‘stroke-width’, ‘0.8’);
svg.appendChild(poly);
}
for (var k = 0; k < K.length; k++) {
var p = pt(k, 100);
var line = document.createElementNS(‘http://www.w3.org/2000/svg’, ‘line’);
line.setAttribute(‘x1’, C); line.setAttribute(‘y1’, C);
line.setAttribute(‘x2’, p[0]); line.setAttribute(‘y2’, p[1]);
line.setAttribute(‘stroke’, ‘#1e293b’); line.setAttribute(‘stroke-width’, ‘0.8’);
svg.appendChild(line);
}
var dpts = [];
for (var k = 0; k < K.length; k++) { dpts.push(pt(k, RV[K[k]] || 50).join(’,’)); }
var dpoly = document.createElementNS(‘http://www.w3.org/2000/svg’, ‘polygon’);
dpoly.setAttribute(‘points’, dpts.join(’ ’));
dpoly.setAttribute(‘fill’, ‘rgba(59,130,246,.18)’);
dpoly.setAttribute(‘stroke’, ‘#3b82f6’);
dpoly.setAttribute(‘stroke-width’, ‘2’);
svg.appendChild(dpoly);
for (var k = 0; k < K.length; k++) {
var lp = pt(k, 122);
var txt = document.createElementNS(‘http://www.w3.org/2000/svg’, ‘text’);
txt.setAttribute(‘x’, lp[0]); txt.setAttribute(‘y’, lp[1]);
txt.setAttribute(‘fill’, ‘#64748b’); txt.setAttribute(‘font-size’, ‘10’);
txt.setAttribute(‘font-weight’, ‘bold’); txt.setAttribute(‘text-anchor’, ‘middle’);
txt.setAttribute(‘dominant-baseline’, ‘middle’);
txt.textContent = L[k];
svg.appendChild(txt);
}
}

function renderDash() {
var t = tot();
var ed = ge(‘ED’), dt = ge(‘DT’), at = ge(‘AT’);
if (ed) { ed.textContent = ‘$’ + Number(DB.emergencyFund || 0).toLocaleString(); }
if (dt) { dt.textContent = ‘$’ + t.toLocaleString(); }
if (at) { at.textContent = ‘$’ + t.toLocaleString(); }
var dy = ge(‘DY’);
if (dy) {
var items = (DB.plans_yearly || []).slice(0, 5);
if (!items.length) { dy.innerHTML = ‘<p class="emp">\u5c1a\u7121\u8a08\u756b</p>’; }
else {
var h = ‘’;
for (var i = 0; i < items.length; i++) {
var p = items[i];
h += ‘<div style="margin-bottom:12px;">’;
h += ‘<div style="display:flex;justify-content:space-between;font-size:13px;font-weight:700;font-style:italic;margin-bottom:4px;">’;
h += ‘<span>’ + esc(p.title) + ‘</span><span style="color:#60a5fa;">’ + (p.progress || 0) + ‘%</span></div>’;
h += ‘<div class="pb"><div class="pf" style="width:' + (p.progress || 0) + '%;"></div></div></div>’;
}
dy.innerHTML = h;
}
}
}

function trashSvg() {
return ‘<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="pointer-events:none;"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>’;
}
function editSvg() {
return ‘<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="pointer-events:none;"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>’;
}

function renderYearly() {
var el = ge(‘YL’); if (!el) { return; }
var items = DB.plans_yearly || [];
if (!items.length) { el.innerHTML = ‘<p class="emp">\u5c1a\u7121\u9805\u76ee</p>’; return; }
var h = ‘’;
for (var i = 0; i < items.length; i++) {
var item = items[i];
h += ‘<div class="di" draggable="true" data-di="plans_yearly" data-idx="' + i + '">’;
h += ‘<div style="flex:1;min-width:0;"><p style="font-size:14px;font-weight:900;font-style:italic;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">’ + esc(item.title) + ‘</p></div>’;
h += ‘<input class="pi" type="number" min="0" max="100" value="' + (item.progress || 0) + '" data-act="prog" data-col="plans_yearly" data-id="' + item.id + '">’;
h += ‘<button class="bd" data-act="del" data-col="plans_yearly" data-id="' + item.id + '">’ + trashSvg() + ‘</button>’;
h += ‘</div>’;
}
el.innerHTML = h;
}

function renderDaily() {
var el = ge(‘DL’); if (!el) { return; }
var items = DB.plans_daily || [];
if (!items.length) { el.innerHTML = ‘<p class="emp">\u5c1a\u7121\u9805\u76ee</p>’; return; }
var h = ‘’;
for (var i = 0; i < items.length; i++) {
var item = items[i];
h += ‘<div class="di">’;
h += ‘<div style="flex:1;min-width:0;"><p style="font-size:14px;font-weight:900;font-style:italic;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">’ + esc(item.title) + ‘</p></div>’;
h += ‘<button class="bd" data-act="del" data-col="plans_daily" data-id="' + item.id + '">’ + trashSvg() + ‘</button>’;
h += ‘</div>’;
}
el.innerHTML = h;
}

function renderAssets() {
var el = ge(‘AL’); if (!el) { return; }
var items = DB.assets || [];
if (!items.length) { el.innerHTML = ‘<p class="emp">\u5c1a\u7121\u8cc7\u7522</p>’; return; }
var h = ‘’;
for (var i = 0; i < items.length; i++) {
var a = items[i];
h += ‘<div class="ai"><div style="flex:1;min-width:0;padding-right:9px;">’;
h += ‘<div style="font-size:13px;font-weight:900;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">’ + esc(a.name) + ‘</div>’;
h += ‘<div style="display:flex;gap:7px;margin-top:3px;align-items:center;"><span style="font-size:10px;color:#64748b;font-weight:900;">’ + esc(a.category) + ‘</span>’;
h += ‘<span style="font-size:14px;font-weight:900;color:#60a5fa;font-style:italic;">$’ + Number(a.amount).toLocaleString() + ‘</span></div></div>’;
h += ‘<div style="display:flex;gap:2px;flex-shrink:0;">’;
h += ‘<button class="be" data-act="editAsset" data-id="' + a.id + '">’ + editSvg() + ‘</button>’;
h += ‘<button class="bd" data-act="del" data-col="assets" data-id="' + a.id + '">’ + trashSvg() + ‘</button>’;
h += ‘</div></div>’;
}
el.innerHTML = h;
}

function renderHealth() {
var hc = ge(‘HC’); if (!hc) { return; }
var logs = DB.health_logs || [];
if (logs.length < 2) { hc.innerHTML = ‘<p class="emp">\u8acb\u65b0\u589e\u81f3\u5c11\u5169\u7b46\u8cc7\u6599</p>’; }
else {
var W = 360, H = 140, P = 22;
var K = [‘weight’,‘fat’,‘muscle’];
var C = [’#3b82f6’,’#ef4444’,’#10b981’];
var LB = [’\u9ad4\u91cd’,’\u9ad4\u8102’,’\u808c\u8089’];
function gp(k) {
var v = [];
for (var i = 0; i < logs.length; i++) { v.push(parseFloat(logs[i][k]) || 0); }
var mn = v[0], mx = v[0];
for (var i = 1; i < v.length; i++) { if(v[i]<mn){mn=v[i];} if(v[i]>mx){mx=v[i];} }
var rng = mx === mn ? 1 : mx - mn;
var pts = [];
for (var i = 0; i < logs.length; i++) {
pts.push({x: P + (i / (logs.length - 1)) * (W - 2*P), y: (H-P) - (v[i]-mn)/rng*(H-2*P)});
}
return pts;
}
var s = ‘’;
for (var ki = 0; ki < K.length; ki++) {
var pts = gp(K[ki]);
var pstr = ‘’;
for (var pi = 0; pi < pts.length; pi++) { pstr += pts[pi].x + ‘,’ + pts[pi].y + ’ ’; }
s += ‘<polyline fill="none" stroke="' + C[ki] + '" stroke-width="2.5" points="' + pstr + '"/>’;
}
var leg = ‘’;
for (var ki = 0; ki < LB.length; ki++) {
leg += ‘<span style="font-size:11px;color:' + C[ki] + ';font-weight:900;display:inline-flex;align-items:center;gap:4px;">’ + LB[ki] + ‘</span>’;
}
hc.innerHTML = ‘<div style="background:rgba(2,6,23,.4);padding:12px;border-radius:11px;border:1px solid #1e293b;"><svg viewBox="0 0 ' + W + ' ' + H + '" style="width:100%;height:120px;">’ + s + ‘</svg><div style="display:flex;gap:16px;justify-content:center;margin-top:8px;">’ + leg + ‘</div></div>’;
}
var hl = ge(‘HL’); if (!hl) { return; }
var recent = logs.slice().reverse().slice(0, 10);
if (!recent.length) { hl.innerHTML = ‘<p class="emp">\u5c1a\u7121\u8a18\u9304</p>’; return; }
var h = ‘’;
for (var i = 0; i < recent.length; i++) {
var l = recent[i];
h += ‘<div style="display:flex;justify-content:space-between;align-items:center;padding:10px 13px;background:rgba(30,41,59,.2);border-radius:10px;margin-bottom:7px;border:1px solid #1e293b;gap:8px;">’;
h += ‘<span style="font-size:11px;color:#64748b;flex-shrink:0;">’ + new Date(l.createdAt).toLocaleDateString(‘zh-TW’) + ‘</span>’;
h += ‘<div style="display:flex;gap:9px;flex-wrap:wrap;flex:1;">’;
if (l.weight) { h += ’<span style="font-size:12px;color:#3b82f6;font-weight:900;">\u9ad4\u91cd ’ + l.weight + ‘kg</span>’; }
if (l.fat) { h += ’<span style="font-size:12px;color:#ef4444;font-weight:900;">\u9ad4\u8102 ’ + l.fat + ‘%</span>’; }
if (l.muscle) { h += ’<span style="font-size:12px;color:#10b981;font-weight:900;">\u808c\u8089 ’ + l.muscle + ‘kg</span>’; }
h += ‘</div><button class="bd" data-act="del" data-col="health_logs" data-id="' + l.id + '">’ + trashSvg() + ‘</button></div>’;
}
hl.innerHTML = h;
}

function renderNotes(key) {
var el = ge(‘NL-’ + key); if (!el) { return; }
var items = DB[‘notes_’ + key] || [];
if (!items.length) { el.innerHTML = ‘<p class="emp">\u5c1a\u7121\u7b46\u8a18</p>’; return; }
var h = ‘’;
for (var i = 0; i < items.length; i++) {
var n = items[i];
h += ‘<div class="nc">’;
h += ‘<button class="nh" data-act="toggleNote" data-nk="' + key + '" data-id="' + n.id + '">’;
h += ‘<span style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;padding-right:8px;">’ + esc(n.title) + ‘</span>’;
h += ‘<span style="color:#475569;flex-shrink:0;">v</span></button>’;
h += ‘<div id="nb-' + key + '-' + n.id + '" class="nb">’;
h += ‘<p style="white-space:pre-wrap;margin-bottom:11px;">’ + esc(n.content || ‘’) + ‘</p>’;
h += ‘<div style="display:flex;justify-content:flex-end;gap:12px;">’;
h += ‘<button class="bsb" data-act="editNote" data-nk="' + key + '" data-id="' + n.id + '">\u7de8\u8f2f</button>’;
h += ‘<button class="bsr" data-act="del" data-col="notes_' + key + '" data-id="' + n.id + '">\u522a\u9664</button>’;
h += ‘</div></div></div>’;
}
el.innerHTML = h;
}

function renderTravel() {
var el = ge(‘TL’); if (!el) { return; }
var items = DB.travel || [];
if (!items.length) { el.innerHTML = ‘<p class="emp">\u5c1a\u7121\u884c\u7a0b</p>’; return; }
var h = ‘’;
for (var i = 0; i < items.length; i++) {
var t = items[i];
h += ‘<div class="tc"><div style="display:flex;align-items:center;gap:12px;"><div class="ti"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg></div>’;
h += ‘<div><p style="font-size:14px;font-weight:900;font-style:italic;color:#fff;">’ + esc(t.destination) + ‘</p>’;
h += ‘<p style="font-size:11px;color:#64748b;margin-top:3px;">’ + esc(t.start) + ’ - ’ + esc(t.end) + ‘</p></div></div>’;
h += ‘<button class="bd" data-act="del" data-col="travel" data-id="' + t.id + '">’ + trashSvg() + ‘</button></div>’;
}
el.innerHTML = h;
}

function renderAll() {
drawRadar();
drawPie(‘PD’, ‘LD’);
drawPie(‘PA’, ‘LA’);
renderDash();
renderYearly();
renderDaily();
renderAssets();
renderHealth();
for (var i = 0; i < NKEYS.length; i++) { renderNotes(NKEYS[i]); }
renderTravel();
}

function callAI(prompt, asJson) {
var url = ‘https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=’ + GK;
var body = {contents:[{parts:[{text:prompt}]}]};
if (asJson) { body.generationConfig = {responseMimeType:‘application/json’}; }
return fetch(url, {method:‘POST’, headers:{‘Content-Type’:‘application/json’}, body:JSON.stringify(body)})
.then(function(r) { return r.json(); })
.then(function(d) {
try { return d.candidates[0].content.parts[0].text || ‘’; } catch(e) { return ‘’; }
});
}

function generateAI() {
if (aiOn) { return; }
aiOn = true;
var btn = document.querySelector(’[data-act=“genAI”]’);
var sum = ge(‘AIS’);
if (btn) { btn.textContent = ‘…’; }
var ctx = ‘total:’ + tot() + ‘, cats:’ + JSON.stringify(cats());
var p1 = callAI(’Score these 5 life areas 0-100, return ONLY JSON: {“wealth”:N,“health”:N,“growth”:N,“discipline”:N,“experience”:N}. Data: ’ + ctx, true);
var p2 = callAI(’Based on: ’ + ctx + ‘, give life/finance advice in Traditional Chinese, ~150 chars.’, false);
Promise.all([p1, p2]).then(function(res) {
try { if (res[0]) { RV = JSON.parse(res[0]); } } catch(e) {}
if (sum) { sum.textContent = res[1] || ‘AI analysis done.’; }
drawRadar();
}).catch(function() {
if (sum) { sum.textContent = ‘AI error. Check connection.’; }
}).then(function() {
aiOn = false;
if (btn) { btn.textContent = ‘\u91cd\u65b0\u7522\u751f’; }
});
}

function getAssetAI() {
if (aiOn) { return; }
aiOn = true;
var btn = document.querySelector(’[data-act=“assetAI”]’);
var adv = ge(‘AA’);
if (btn) { btn.textContent = ‘…’; }
callAI(’Asset allocation: ’ + JSON.stringify(cats()) + ‘. Give optimization advice in Traditional Chinese ~100 chars.’, false)
.then(function(r) { if (adv) { adv.textContent = r || ‘Done.’; } })
.catch(function() { if (adv) { adv.textContent = ‘AI error.’; } })
.then(function() { aiOn = false; if (btn) { btn.textContent = ‘\u958b\u59cb\u5206\u6790’; } });
}

function doVoice() {
var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
if (!SR) { alert(‘Voice input requires Chrome.’); return; }
var rec = new SR();
rec.lang = ‘zh-TW’;
rec.start();
rec.onresult = function(ev) {
var t = ev.results[0][0].transcript;
callAI(‘Parse: “’ + t + ‘”. Return ONLY JSON: {“type”:“health_logs”,“data”:{“weight”:N_or_null,“fat”:N_or_null,“muscle”:N_or_null}}’, true)
.then(function(r) {
try {
var p = JSON.parse(r);
if (!DB[p.type]) { DB[p.type] = []; }
DB[p.type].push(merge({id:uid(), createdAt:Date.now()}, p.data));
lsSet(‘lm10’, DB);
renderAll();
} catch(e) {}
});
};
}

renderAll();
</script>

</body>
</html>
