<!DOCTYPE html>

<html lang="zh-TW">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>äººç”Ÿç®¡ç† | Life Manager Pro</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{background:#020617;color:#e2e8f0;font-family:-apple-system,BlinkMacSystemFont,'Helvetica Neue',Arial,sans-serif;min-height:100vh;font-size:15px;}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.app{display:flex;min-height:100vh;}
.sidebar{position:fixed;left:0;top:0;bottom:0;width:64px;background:#0f172a;border-right:1px solid #1e293b;display:flex;flex-direction:column;align-items:center;padding:20px 0;z-index:100;}
.main{margin-left:64px;padding:26px 22px;width:calc(100% - 64px);min-height:100vh;overflow-y:auto;-webkit-overflow-scrolling:touch;}
.nav-btn{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:54px;border:none;background:transparent;cursor:pointer;color:#64748b;border-right:3px solid transparent;touch-action:manipulation;-webkit-tap-highlight-color:transparent;}
.nav-btn.active{color:#60a5fa;background:rgba(59,130,246,.12);border-right-color:#3b82f6;}
.nav-btn svg{width:20px;height:20px;pointer-events:none;}
.nav-label{font-size:9px;margin-top:4px;font-weight:900;text-transform:uppercase;letter-spacing:.05em;pointer-events:none;}
.voice-btn{margin-top:auto;margin-bottom:12px;width:40px;height:40px;border-radius:50%;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;background:#1e293b;color:#94a3b8;touch-action:manipulation;-webkit-tap-highlight-color:transparent;}
.voice-btn.on{background:#ef4444;color:#fff;animation:pulse 1.5s infinite;}
.card{background:#0f172a;border:1px solid #1e293b;border-radius:18px;padding:20px;}
.total-card{background:#0f172a;border:1px solid #1e293b;border-radius:24px;padding:26px;text-align:center;}
.ai-blue{background:linear-gradient(135deg,rgba(23,37,84,.5),#0f172a);border:1px solid rgba(59,130,246,.3);border-radius:18px;padding:18px;}
.ai-green{background:#0f172a;border:1px solid rgba(16,185,129,.3);border-radius:16px;padding:16px;}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.gridA{display:grid;grid-template-columns:1.4fr 1fr;gap:16px;}
.page{display:none;}
.page.on{display:flex;flex-direction:column;gap:16px;animation:fadeIn .2s ease;}
.sec{font-size:13px;font-weight:900;font-style:italic;text-transform:uppercase;letter-spacing:.1em;color:#94a3b8;}
.lxs{font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.14em;color:#64748b;}
.empty{color:#475569;font-size:14px;font-style:italic;text-align:center;padding:18px 0;}
.hrow{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;}
.bb{background:#2563eb;color:#fff;border:none;border-radius:10px;padding:9px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;touch-action:manipulation;-webkit-tap-highlight-color:transparent;}
.bg{background:#059669;color:#fff;border:none;border-radius:10px;padding:9px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;touch-action:manipulation;-webkit-tap-highlight-color:transparent;}
.bgh{background:rgba(59,130,246,.15);color:#60a5fa;border:1px solid rgba(59,130,246,.3);border-radius:8px;padding:7px 13px;font-size:11px;font-weight:900;cursor:pointer;white-space:nowrap;touch-action:manipulation;-webkit-tap-highlight-color:transparent;}
.bgg{background:rgba(16,185,129,.1);color:#34d399;border:1px solid rgba(16,185,129,.25);border-radius:8px;padding:7px 13px;font-size:11px;font-weight:900;cursor:pointer;touch-action:manipulation;-webkit-tap-highlight-color:transparent;}
.bd{background:none;border:none;color:#475569;cursor:pointer;padding:5px;display:inline-flex;align-items:center;touch-action:manipulation;-webkit-tap-highlight-color:transparent;}
.be{background:none;border:none;color:#475569;cursor:pointer;padding:5px;display:inline-flex;align-items:center;touch-action:manipulation;-webkit-tap-highlight-color:transparent;}
.bsb{background:none;border:none;font-size:11px;font-weight:900;text-transform:uppercase;cursor:pointer;color:#60a5fa;padding:0;touch-action:manipulation;}
.bsr{background:none;border:none;font-size:11px;font-weight:900;text-transform:uppercase;cursor:pointer;color:#ef4444;padding:0;touch-action:manipulation;}
.pbar{height:5px;background:#1e293b;border-radius:9999px;overflow:hidden;margin-top:4px;}
.pfil{height:100%;background:#3b82f6;border-radius:9999px;}
.pinp{width:46px;text-align:center;font-size:12px;font-weight:900;color:#60a5fa;padding:3px;background:#020617;border:1px solid #334155;border-radius:6px;font-family:inherit;}
.aitem{padding:12px 14px;background:rgba(30,41,59,.25);border:1px solid #1e293b;border-radius:12px;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.ditem{padding:12px 14px;background:rgba(30,41,59,.2);border:1px solid #1e293b;border-radius:12px;display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.ditem.dov{opacity:.3;border-color:#3b82f6;}
.nc{background:rgba(30,41,59,.2);border:1px solid #1e293b;border-radius:12px;overflow:hidden;margin-bottom:8px;}
.nhdr{width:100%;padding:12px 14px;display:flex;justify-content:space-between;align-items:center;background:none;border:none;color:#e2e8f0;cursor:pointer;font-size:13px;font-weight:900;font-style:italic;text-align:left;font-family:inherit;touch-action:manipulation;-webkit-tap-highlight-color:transparent;}
.nbody{padding:14px;border-top:1px solid rgba(30,41,59,.6);background:rgba(2,6,23,.4);font-size:13px;color:#94a3b8;line-height:1.65;display:none;}
.nbody.on{display:block;}
.tcard{padding:15px;background:rgba(30,41,59,.2);border:1px solid #1e293b;border-radius:16px;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.tico{padding:9px;background:rgba(16,185,129,.1);border-radius:10px;color:#10b981;display:flex;}
.mwrap{position:fixed;inset:0;z-index:300;display:none;align-items:center;justify-content:center;padding:16px;background:rgba(0,0,0,.85);}
.mwrap.on{display:flex;}
.mbox{position:relative;background:#0f172a;border:1px solid #1e293b;width:100%;max-width:420px;border-radius:28px;padding:32px;box-shadow:0 30px 60px rgba(0,0,0,.7);max-height:90vh;overflow-y:auto;-webkit-overflow-scrolling:touch;}
.mtit{font-size:18px;font-weight:900;font-style:italic;text-transform:uppercase;letter-spacing:-.03em;color:#fff;margin-bottom:22px;}
.mcls{position:absolute;top:14px;right:14px;background:#1e293b;border:none;color:#64748b;cursor:pointer;width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;touch-action:manipulation;}
.fg{display:flex;flex-direction:column;gap:6px;margin-bottom:14px;}
.fg label{font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.14em;color:#64748b;}
.fg input,.fg textarea{background:#1e293b;border:1px solid #334155;border-radius:11px;padding:12px 15px;font-size:15px;color:#e2e8f0;outline:none;width:100%;font-family:inherit;-webkit-appearance:none;}
.fg input[type=date]{color-scheme:dark;}
.fg textarea{height:100px;resize:vertical;}
.msub{width:100%;padding:14px;background:#2563eb;color:#fff;border:none;border-radius:12px;font-size:13px;font-weight:900;text-transform:uppercase;letter-spacing:.18em;cursor:pointer;touch-action:manipulation;}
@media(max-width:700px){
  .grid2{grid-template-columns:1fr;}
  .gridA{grid-template-columns:1fr;}
  .main{margin-left:0;padding:14px 14px 76px;width:100%;}
  .sidebar{width:100%;height:60px;top:auto;bottom:0;flex-direction:row;border-right:none;border-top:1px solid #1e293b;padding:0;justify-content:space-around;}
  .nav-btn{height:60px;width:auto;border-right:none;border-top:3px solid transparent;flex:1;padding:0 4px;}
  .nav-btn.active{border-top-color:#3b82f6;border-right:none;background:rgba(59,130,246,.1);}
  .voice-btn{margin:0;flex-shrink:0;}
}
</style>
</head>
<body>
<div class="app">

<nav class="sidebar" id="sidebar">
  <div style="margin-bottom:20px;color:#3b82f6;flex-shrink:0;">
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96-.46 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96-.46 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>
  </div>
  <button class="nav-btn active" data-tab="dash">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>
    <span class="nav-label">ç¸½è¦½</span>
  </button>
  <button class="nav-btn" data-tab="plans">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
    <span class="nav-label">è¨ˆç•«</span>
  </button>
  <button class="nav-btn" data-tab="health">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
    <span class="nav-label">å¥åº·</span>
  </button>
  <button class="nav-btn" data-tab="assets">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>
    <span class="nav-label">è³‡ç”¢</span>
  </button>
  <button class="nav-btn" data-tab="notes">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
    <span class="nav-label">ç­†è¨˜</span>
  </button>
  <button class="nav-btn" data-tab="travel">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" y1="3" x2="9" y2="18"/><line x1="15" y1="6" x2="15" y2="21"/></svg>
    <span class="nav-label">æ—…éŠ</span>
  </button>
  <button class="voice-btn" id="voiceBtn">
    <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/></svg>
  </button>
</nav>

<main class="main" id="mainArea">
  <div style="margin-bottom:22px;">
    <h1 style="font-size:23px;font-weight:900;color:#fff;font-style:italic;text-transform:uppercase;letter-spacing:-.04em;">äººç”Ÿç®¡ç†</h1>
    <p class="lxs" style="margin-top:4px;">Efficiency &amp; Vision</p>
  </div>

  <!-- Dashboard -->

  <div id="pg-dash" class="page on">
    <div class="grid2">
      <div class="card" style="display:flex;flex-direction:column;align-items:center;gap:12px;">
        <p style="font-size:11px;font-weight:900;color:#60a5fa;text-transform:uppercase;letter-spacing:.13em;font-style:italic;">â¬¡ äººç”Ÿé›·é”åœ–</p>
        <svg id="radarSvg" viewBox="0 0 200 200" style="width:100%;max-width:190px;display:block;"></svg>
      </div>
      <div class="ai-blue" style="display:flex;flex-direction:column;gap:11px;">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <span style="font-size:11px;font-weight:900;color:#60a5fa;text-transform:uppercase;letter-spacing:.07em;font-style:italic;">âœ¦ AI ç”Ÿå‘½åˆ†æ</span>
          <button class="bgh" data-act="genAI">é‡æ–°ç”¢ç”Ÿ</button>
        </div>
        <p id="aiSum" style="font-size:13px;color:#cbd5e1;line-height:1.7;white-space:pre-wrap;flex:1;min-height:60px;">é»æ“Šã€Œé‡æ–°ç”¢ç”Ÿã€å–å¾— AI å°ˆå±¬åˆ†æ...</p>
      </div>
    </div>
    <div class="card">
      <p class="sec" style="margin-bottom:13px;">ğŸ“… å¹´åº¦ç›®æ¨™é€²åº¦</p>
      <div id="dash-yearly"></div>
    </div>
    <div class="total-card">
      <p class="lxs">ç¸½è³‡ç”¢å¸‚å€¼ï¼ˆæ·¨å€¼ï¼‰</p>
      <div id="dashTotal" style="font-size:34px;font-weight:900;color:#fff;font-style:italic;margin:8px 0 20px;"></div>
      <svg id="pie-dash" viewBox="-1.15 -1.15 2.3 2.3" style="transform:rotate(-90deg);width:100%;max-width:210px;height:auto;display:block;margin:0 auto;"></svg>
      <div id="leg-dash" style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:13px;"></div>
      <div style="margin-top:20px;padding-top:18px;border-top:1px solid #1e293b;display:flex;justify-content:space-between;align-items:center;">
        <div>
          <p class="lxs">ç·Šæ€¥é å‚™é‡‘</p>
          <p id="emgDisplay" style="font-size:21px;font-weight:900;color:#60a5fa;font-style:italic;margin-top:4px;">$0</p>
        </div>
        <button class="bgh" data-act="editEmg">ä¿®æ”¹é‡‘é¡</button>
      </div>
    </div>
  </div>

  <!-- Plans -->

  <div id="pg-plans" class="page">
    <div class="card">
      <div class="hrow"><span class="sec">å¹´åº¦ç›®æ¨™è¨ˆç•«</span>
        <button class="bb" data-act="addYearly"><svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
      </div>
      <div id="yearlyList"></div>
    </div>
    <div class="card">
      <div class="hrow"><span class="sec">æ¯æ—¥ä»»å‹™ç®¡ç†</span>
        <button class="bb" data-act="addDaily"><svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
      </div>
      <div id="dailyList"></div>
    </div>
  </div>

  <!-- Health -->

  <div id="pg-health" class="page">
    <div class="card">
      <div class="hrow"><span class="sec">å¥åº·æ•¸æ“šè¶¨å‹¢</span>
        <button class="bb" data-act="addHealth"><svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
      </div>
      <div id="healthChart"></div>
      <p class="lxs" style="margin:15px 0 9px;">æ­·å²è¨˜éŒ„</p>
      <div id="healthLogs"></div>
    </div>
  </div>

  <!-- Assets -->

  <div id="pg-assets" class="page">
    <div class="ai-green">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:9px;">
        <span style="font-size:11px;font-weight:900;color:#34d399;text-transform:uppercase;letter-spacing:.07em;">â“˜ AI è³‡ç”¢é…ç½®å»ºè­°</span>
        <button class="bgg" data-act="assetAI">é–‹å§‹åˆ†æ</button>
      </div>
      <p id="assetAdv" style="font-size:13px;color:#94a3b8;line-height:1.6;font-style:italic;">é»æ“Šã€Œé–‹å§‹åˆ†æã€ï¼ŒAI å°‡æä¾›è³‡ç”¢é…ç½®å„ªåŒ–å»ºè­°ã€‚</p>
    </div>
    <div class="gridA">
      <div class="total-card" style="border-radius:22px;">
        <p class="lxs">ç¸½è³‡ç”¢å¸‚å€¼</p>
        <div id="assetTotal" style="font-size:26px;font-weight:900;color:#fff;font-style:italic;margin:7px 0 17px;"></div>
        <svg id="pie-asset" viewBox="-1.15 -1.15 2.3 2.3" style="transform:rotate(-90deg);width:100%;max-width:190px;height:auto;display:block;margin:0 auto;"></svg>
        <div id="leg-asset" style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:11px;"></div>
      </div>
      <div class="card">
        <div class="hrow"><span class="sec">è³‡ç”¢æ˜ç´°</span>
          <button class="bb" data-act="addAsset"><svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
        </div>
        <div id="assetList"></div>
      </div>
    </div>
  </div>

  <!-- Notes -->

  <div id="pg-notes" class="page">
    <div class="grid2">
      <div class="card"><div class="hrow"><span class="lxs">äººç”Ÿæˆé•·</span><button class="bb" data-act="addNote-life" style="padding:7px;"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="notes-life"></div></div>
      <div class="card"><div class="hrow"><span class="lxs">æ›¸ç±é‡é»</span><button class="bb" data-act="addNote-book" style="padding:7px;"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="notes-book"></div></div>
      <div class="card"><div class="hrow"><span class="lxs">å°æŒ‡äº¤æ˜“</span><button class="bb" data-act="addNote-trading" style="padding:7px;"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="notes-trading"></div></div>
      <div class="card"><div class="hrow"><span class="lxs">ç¶²è·¯å¿ƒå¾—</span><button class="bb" data-act="addNote-web" style="padding:7px;"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="notes-web"></div></div>
    </div>
  </div>

  <!-- Travel -->

  <div id="pg-travel" class="page">
    <div class="card">
      <div class="hrow"><span class="sec">æ—…éŠé¡˜æœ›èˆ‡è¡Œç¨‹</span>
        <button class="bg" data-act="addTravel"><svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
      </div>
      <div id="travelList"></div>
    </div>
  </div>
</main>
</div>

<!-- Modal -->

<div class="mwrap" id="mwrap">
  <div class="mbox">
    <button class="mcls" data-act="closeModal"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
    <div id="mTit" class="mtit"></div>
    <form id="mForm"><div id="mFields"></div><button type="submit" class="msub">ç¢ºèªé€å‡º</button></form>
  </div>
</div>

<script>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SAFARI-SAFE: ONE event listener on document.body
   All interactions via data-act / data-* attributes
   No cloneNode. No touchend. No async/await.
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

var GK = 'AIzaSyAky6gF4ekVOuL0JiCr8ayBpD83wrLqe28';
var PC = ['#3b82f6','#10b981','#f59e0b','#ef4444','#8b5cf6'];
var PAGES = ['dash','plans','health','assets','notes','travel'];
var NKEYS = ['life','book','trading','web'];

function ls(k){ try{return JSON.parse(localStorage.getItem(k)||'null');}catch(e){return null;} }
function ss(k,v){ try{localStorage.setItem(k,JSON.stringify(v));}catch(e){} }
function uid(){ return '_'+Math.random().toString(36).slice(2)+Date.now().toString(36); }
function esc(s){ return String(s==null?'':s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function el(id){ return document.getElementById(id); }

var DB = ls('lm5') || {};
var radar = {wealth:50,health:50,growth:50,discipline:50,experience:50};
var aiOn = false;
var dragSrc = null;
var mMeta = {};
var curTab = 'dash';

if (!DB.assets || !DB.assets.length) {
  DB.assets = [
    {id:uid(),name:'å°è‚¡',amount:2544261,category:'å°è‚¡',createdAt:Date.now()},
    {id:uid(),name:'ç¾è‚¡',amount:829175,category:'ç¾è‚¡',createdAt:Date.now()},
    {id:uid(),name:'å°æ–°å¤–å¹£(æ´»)-USD',amount:4257,category:'ç¾è‚¡',createdAt:Date.now()},
    {id:uid(),name:'å°æ–°å¤–å¹£(æ´»)-JPY',amount:6006,category:'ç¾é‡‘',createdAt:Date.now()},
    {id:uid(),name:'å°æ–°å¤–å¹£(å®š)-USD',amount:75473,category:'ç¾è‚¡',createdAt:Date.now()},
    {id:uid(),name:'åˆåº«(æ´»å­˜)',amount:1357878,category:'ç¾é‡‘',createdAt:Date.now()},
    {id:uid(),name:'å°æ–°(æ´»å­˜)',amount:57170,category:'ç¾é‡‘',createdAt:Date.now()},
    {id:uid(),name:'å½°éŠ€(æ´»å­˜)',amount:457003,category:'ç¾é‡‘',createdAt:Date.now()},
    {id:uid(),name:'å…†è±(å‚™ç”¨é‡‘)',amount:43314,category:'ç¾é‡‘',createdAt:Date.now()},
    {id:uid(),name:'é»ƒé‡‘(2.2ç›å¸)',amount:357357,category:'é»ƒé‡‘',createdAt:Date.now()},
    {id:uid(),name:'å°å¹£ç¾é‡‘',amount:20000,category:'ç¾é‡‘',createdAt:Date.now()},
    {id:uid(),name:'å€Ÿå¿—',amount:300000,category:'å€Ÿæ¬¾',createdAt:Date.now()}
  ];
  ss('lm5', DB);
}

// â”€â”€ SINGLE global click handler â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Bound once on document â€” never removed, never re-added
// Works on ALL elements including dynamically rendered ones
document.addEventListener('click', function(e) {
  var t = e.target;
  // Walk up DOM to find data-act or data-* handler
  while (t && t !== document) {
    var act = t.getAttribute('data-act');
    if (act) { handleAct(act, t, e); return; }
    // data-tab on nav buttons
    var tab = t.getAttribute('data-tab');
    if (tab) { switchTab(tab); return; }
    t = t.parentElement;
  }
});

// â”€â”€ change handler for progress inputs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('change', function(e) {
  var t = e.target;
  if (t.getAttribute('data-act') === 'prog') {
    var col = t.getAttribute('data-col');
    var id  = t.getAttribute('data-id');
    var v   = Math.min(100, Math.max(0, parseInt(t.value) || 0));
    if (!DB[col]) return;
    DB[col] = DB[col].map(function(x){ return x.id===id ? merge(x,{progress:v}) : x; });
    ss('lm5',DB); renderAll();
  }
});

function handleAct(act, el, e) {
  // Tab actions
  if (act === 'closeModal') { closeModal(); return; }
  if (act === 'genAI')   { generateAI(); return; }
  if (act === 'assetAI') { getAssetAI(); return; }
  if (act === 'voice')   { handleVoice(); return; }
  if (act === 'editEmg') { openModal('emergency_fund','edit','ä¿®æ”¹ç·Šæ€¥é å‚™é‡‘',[{name:'value',label:'é‡‘é¡',type:'number'}]); return; }
  if (act === 'addYearly'){ openModal('plans_yearly','add','æ–°å¢å¹´åº¦è¨ˆç•«',[{name:'title',label:'ç›®æ¨™åç¨±',type:'text'},{name:'progress',label:'ç›®å‰é€²åº¦(%)',type:'number'}]); return; }
  if (act === 'addDaily') { openModal('plans_daily','add','æ–°å¢æ¯æ—¥ä»»å‹™',[{name:'title',label:'ä»»å‹™å…§å®¹',type:'text'}]); return; }
  if (act === 'addHealth'){ openModal('health_logs','add','è¨˜éŒ„ä»Šæ—¥æ•¸æ“š',[{name:'weight',label:'é«”é‡(kg)',type:'number'},{name:'fat',label:'é«”è„‚(%)',type:'number'},{name:'muscle',label:'è‚Œè‚‰é‡(kg)',type:'number'}]); return; }
  if (act === 'addAsset') { openModal('assets','add','æ–°å¢è³‡ç”¢',[{name:'name',label:'åç¨±',type:'text'},{name:'amount',label:'å¸‚å€¼é‡‘é¡',type:'number'},{name:'category',label:'åˆ†é¡(å°è‚¡/ç¾è‚¡/ç¾é‡‘/é»ƒé‡‘/å€Ÿæ¬¾)',type:'text'}]); return; }
  if (act === 'addTravel'){ openModal('travel','add','æ–°å¢æ—…éŠè¡Œç¨‹',[{name:'destination',label:'ç›®çš„åœ°',type:'text'},{name:'start',label:'é–‹å§‹æ—¥æœŸ',type:'date'},{name:'end',label:'çµæŸæ—¥æœŸ',type:'date'}]); return; }
  if (act.indexOf('addNote-') === 0) {
    var nk = act.slice(8);
    openModal('notes_'+nk,'add','æ–°å¢ç­†è¨˜',[{name:'title',label:'æ¨™é¡Œ',type:'text'},{name:'content',label:'å…§å®¹',type:'textarea'}]); return;
  }
  // Delete
  if (act === 'del') {
    var col = el.getAttribute('data-col'), id = el.getAttribute('data-id');
    if (!DB[col]) return;
    DB[col] = DB[col].filter(function(x){return x.id!==id;});
    ss('lm5',DB); renderAll(); return;
  }
  // Edit asset
  if (act === 'editAsset') {
    var id = el.getAttribute('data-id');
    openModal('assets','edit','ç·¨è¼¯è³‡ç”¢',[{name:'name',label:'åç¨±',type:'text'},{name:'amount',label:'å¸‚å€¼é‡‘é¡',type:'number'},{name:'category',label:'åˆ†é¡',type:'text'}], id); return;
  }
  // Edit note
  if (act === 'editNote') {
    var nk = el.getAttribute('data-nk'), id = el.getAttribute('data-id');
    openModal('notes_'+nk,'edit','ç·¨è¼¯ç­†è¨˜',[{name:'title',label:'æ¨™é¡Œ',type:'text'},{name:'content',label:'å…§å®¹',type:'textarea'}], id); return;
  }
  // Toggle note
  if (act === 'toggleNote') {
    var nk = el.getAttribute('data-nk'), id = el.getAttribute('data-id');
    var body = document.getElementById('nb-'+nk+'-'+id);
    var chev = document.getElementById('nc-'+nk+'-'+id);
    if (!body) return;
    var isOpen = body.className === 'nbody on';
    body.className = isOpen ? 'nbody' : 'nbody on';
    if (chev) chev.textContent = isOpen ? 'â–¾' : 'â–´';
    return;
  }
}

// â”€â”€ Tab switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(id) {
  curTab = id;
  PAGES.forEach(function(p) {
    var pg = document.getElementById('pg-'+p);
    if (pg) pg.className = (p===id) ? 'page on' : 'page';
  });
  // Update nav buttons
  var navBtns = document.querySelectorAll('.nav-btn');
  for (var i=0; i<navBtns.length; i++) {
    var tab = navBtns[i].getAttribute('data-tab');
    navBtns[i].className = (tab===id) ? 'nav-btn active' : 'nav-btn';
  }
  renderAll();
}

// Voice button needs direct binding since it has no data-act in HTML
document.getElementById('voiceBtn').addEventListener('click', function() { handleVoice(); });

// â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Close on backdrop click
document.getElementById('mwrap').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});

document.getElementById('mForm').addEventListener('submit', function(e) {
  e.preventDefault();
  var data = {}, fd = new FormData(e.target);
  fd.forEach(function(v,k){ data[k]=v; });
  var col=mMeta.col, type=mMeta.type, eid=mMeta.eid;
  if (col==='emergency_fund') {
    DB.emergencyFund = Number(data.value);
  } else if (type==='edit') {
    DB[col] = (DB[col]||[]).map(function(x){ return x.id===eid ? merge(x,data) : x; });
  } else {
    if (!DB[col]) DB[col]=[];
    DB[col].push(merge({id:uid(),createdAt:Date.now()}, data));
  }
  ss('lm5',DB); closeModal(); renderAll();
});

function openModal(col, type, title, fields, editId) {
  mMeta = {col:col, type:type, eid:editId};
  document.getElementById('mTit').textContent = title;
  var init = {};
  if (type==='edit' && editId && col!=='emergency_fund') {
    (DB[col]||[]).forEach(function(x){ if(x.id===editId) init=x; });
  }
  if (col==='emergency_fund') init={value:DB.emergencyFund||0};
  document.getElementById('mFields').innerHTML = fields.map(function(f){
    var v = esc(String(init[f.name]==null?'':init[f.name]));
    return '<div class="fg"><label>'+f.label+'</label>'
      +(f.type==='textarea'?'<textarea name="'+f.name+'">'+v+'</textarea>':'<input name="'+f.name+'" type="'+f.type+'" step="any" value="'+v+'">')

```
  +'</div>';
```

}).join(â€™â€™);
document.getElementById(â€˜mwrapâ€™).className = â€˜mwrap onâ€™;
}

function closeModal() {
document.getElementById(â€˜mwrapâ€™).className = â€˜mwrapâ€™;
}

// â”€â”€ Data helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function merge(a,b){ var r={}; for(var k in a) r[k]=a[k]; for(var k in b) r[k]=b[k]; return r; }

function cats() {
var c={â€˜å°è‚¡â€™:0,â€˜ç¾è‚¡â€™:0,â€˜ç¾é‡‘â€™:0,â€˜é»ƒé‡‘â€™:0,â€˜å€Ÿæ¬¾â€™:0};
(DB.assets||[]).forEach(function(a){
var cat=a.category||â€˜ç¾é‡‘â€™;
c[cat]=(c[cat]||0)+(Number(a.amount)||0);
});
return Object.keys(c).map(function(k){return{name:k,amt:c[k]};});
}
function tot(){ return cats().reduce(function(s,x){return s+x.amt;},0); }

// â”€â”€ Charts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawPie(svgId, legId) {
var svg=document.getElementById(svgId), leg=document.getElementById(legId);
if(!svg) return;
svg.innerHTML=â€™â€™;
var data=cats(), total=tot();
if(!total) return;
var cum=0;
function pt(p){return[Math.cos(2*Math.PI*p),Math.sin(2*Math.PI*p)];}
data.forEach(function(d,i){
var pct=d.amt/total; if(pct<=0) return;
var a0=cum; cum+=pct;
var p0=pt(a0),p1=pt(cum),pm=pt(a0+pct/2);
var large=pct>.5?1:0;
var path=document.createElementNS(â€˜http://www.w3.org/2000/svgâ€™,â€˜pathâ€™);
path.setAttribute(â€˜dâ€™,â€˜Mâ€™+p0[0]+â€™ â€˜+p0[1]+â€™ A1 1 0 â€˜+large+â€™ 1 â€˜+p1[0]+â€™ â€˜+p1[1]+â€™ L0 0â€™);
path.setAttribute(â€˜fillâ€™,PC[i%PC.length]);
path.setAttribute(â€˜strokeâ€™,â€™#020617â€™); path.setAttribute(â€˜stroke-widthâ€™,â€˜0.025â€™);
svg.appendChild(path);
if(pct>.07){
var tx=document.createElementNS(â€˜http://www.w3.org/2000/svgâ€™,â€˜textâ€™);
var x=pm[0]*.67,y=pm[1]*.67;
tx.setAttribute(â€˜xâ€™,x); tx.setAttribute(â€˜yâ€™,y);
tx.setAttribute(â€˜fillâ€™,â€™#fffâ€™); tx.setAttribute(â€˜font-sizeâ€™,â€˜0.115â€™);
tx.setAttribute(â€˜font-weightâ€™,â€˜boldâ€™); tx.setAttribute(â€˜text-anchorâ€™,â€˜middleâ€™);
tx.setAttribute(â€˜dominant-baselineâ€™,â€˜middleâ€™);
tx.setAttribute(â€˜transformâ€™,â€˜rotate(90,â€™+x+â€™,â€™+y+â€™)â€™);
tx.textContent=d.name+â€™ â€˜+Math.round(pct*100)+â€™%â€™;
svg.appendChild(tx);
}
});
if(leg) leg.innerHTML=data.map(function(d,i){
var col=PC[i%PC.length];
return â€˜<span style="font-size:11px;font-weight:700;color:'+col+';display:inline-flex;align-items:center;gap:4px;">â€™
+â€™<span style="width:8px;height:8px;border-radius:50%;background:'+col+';display:inline-block;"></span>â€™
+d.name+â€™: $â€™+Number(d.amt).toLocaleString()+â€™</span>â€™;
}).join(â€™â€™);
}

function drawRadar() {
var svg=document.getElementById(â€˜radarSvgâ€™); if(!svg) return;
svg.innerHTML=â€™â€™;
var K=[â€˜wealthâ€™,â€˜healthâ€™,â€˜growthâ€™,â€˜disciplineâ€™,â€˜experienceâ€™],L=[â€˜è²¡å‹™â€™,â€˜å¥åº·â€™,â€˜æˆé•·â€™,â€˜è‡ªå¾‹â€™,â€˜é«”é©—â€™];
var C=100,R=64;
function pt(i,v){var a=Math.PI*2*i/5-Math.PI/2;return[C+R*(v/100)*Math.cos(a),C+R*(v/100)*Math.sin(a)];}
[20,40,60,80,100].forEach(function(v){
var el=document.createElementNS(â€˜http://www.w3.org/2000/svgâ€™,â€˜polygonâ€™);
el.setAttribute(â€˜pointsâ€™,K.map(function(*,j){return pt(j,v).join(â€™,â€™);}).join(â€™ â€˜));
el.setAttribute(â€˜fillâ€™,â€˜noneâ€™);el.setAttribute(â€˜strokeâ€™,â€™#1e293bâ€™);el.setAttribute(â€˜stroke-widthâ€™,â€˜0.8â€™);
svg.appendChild(el);
});
K.forEach(function(*,i){
var p=pt(i,100),el=document.createElementNS(â€˜http://www.w3.org/2000/svgâ€™,â€˜lineâ€™);
el.setAttribute(â€˜x1â€™,C);el.setAttribute(â€˜y1â€™,C);el.setAttribute(â€˜x2â€™,p[0]);el.setAttribute(â€˜y2â€™,p[1]);
el.setAttribute(â€˜strokeâ€™,â€™#1e293bâ€™);el.setAttribute(â€˜stroke-widthâ€™,â€˜0.8â€™);svg.appendChild(el);
});
var poly=document.createElementNS(â€˜http://www.w3.org/2000/svgâ€™,â€˜polygonâ€™);
poly.setAttribute(â€˜pointsâ€™,K.map(function(k,i){return pt(i,radar[k]||50).join(â€™,â€™);}).join(â€™ â€˜));
poly.setAttribute(â€˜fillâ€™,â€˜rgba(59,130,246,.18)â€™);poly.setAttribute(â€˜strokeâ€™,â€™#3b82f6â€™);
poly.setAttribute(â€˜stroke-widthâ€™,â€˜2â€™);poly.setAttribute(â€˜stroke-linejoinâ€™,â€˜roundâ€™);
svg.appendChild(poly);
K.forEach(function(k,i){
var p=pt(i,radar[k]||50),c=document.createElementNS(â€˜http://www.w3.org/2000/svgâ€™,â€˜circleâ€™);
c.setAttribute(â€˜cxâ€™,p[0]);c.setAttribute(â€˜cyâ€™,p[1]);c.setAttribute(â€˜râ€™,â€˜3.5â€™);c.setAttribute(â€˜fillâ€™,â€™#3b82f6â€™);
svg.appendChild(c);
});
L.forEach(function(l,i){
var p=pt(i,122),t=document.createElementNS(â€˜http://www.w3.org/2000/svgâ€™,â€˜textâ€™);
t.setAttribute(â€˜xâ€™,p[0]);t.setAttribute(â€˜yâ€™,p[1]);t.setAttribute(â€˜fillâ€™,â€™#64748bâ€™);
t.setAttribute(â€˜font-sizeâ€™,â€˜10â€™);t.setAttribute(â€˜font-weightâ€™,â€˜boldâ€™);
t.setAttribute(â€˜text-anchorâ€™,â€˜middleâ€™);t.setAttribute(â€˜dominant-baselineâ€™,â€˜middleâ€™);
t.textContent=l; svg.appendChild(t);
});
}

function drawHealth() {
var cont=document.getElementById(â€˜healthChartâ€™); if(!cont) return;
var data=DB.health_logs||[];
if(data.length<2){cont.innerHTML=â€™<p class="empty">è«‹æ–°å¢è‡³å°‘å…©ç­†è³‡æ–™ä»¥é¡¯ç¤ºè¶¨å‹¢åœ–</p>â€™;return;}
var W=360,H=140,P=22,K=[â€˜weightâ€™,â€˜fatâ€™,â€˜muscleâ€™],C=[â€™#3b82f6â€™,â€™#ef4444â€™,â€™#10b981â€™],L=[â€˜é«”é‡â€™,â€˜é«”è„‚â€™,â€˜è‚Œè‚‰â€™];
function gp(k){
var v=data.map(function(d){return parseFloat(d[k])||0;});
var mn=Math.min.apply(null,v),mx=Math.max.apply(null,v),rng=mx===mn?1:mx-mn;
return data.map(function(d,i){return{x:P+(i/(data.length-1))*(W-2*P),y:(H-P)-((parseFloat(d[k])||0)-mn)/rng*(H-2*P)};});
}
var s=â€™â€™;
K.forEach(function(k,i){
var pts=gp(k);
s+=â€™<polyline fill="none" stroke="'+C[i]+'" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" points="'+pts.map(function(p){return p.x+','+p.y;}).join(' ')+'"/>â€™;
pts.forEach(function(p){s+=â€™<circle cx="'+p.x+'" cy="'+p.y+'" r="4" fill="'+C[i]+'" stroke="#020617" stroke-width="1.5"/>â€™;});
});
var leg=L.map(function(l,i){returnâ€™<span style="font-size:11px;color:'+C[i]+';font-weight:900;display:inline-flex;align-items:center;gap:4px;"><span style="width:12px;height:3px;background:'+C[i]+';border-radius:2px;display:inline-block;"></span>â€™+l+â€™</span>â€™;}).join(â€™â€™);
cont.innerHTML=â€™<div style="background:rgba(2,6,23,.4);padding:12px;border-radius:11px;border:1px solid #1e293b;"><svg viewBox="0 0 '+W+' '+H+'" style="width:100%;height:120px;overflow:visible;">â€™+s+â€™</svg><div style="display:flex;gap:16px;justify-content:center;margin-top:8px;">â€™+leg+â€™</div></div>â€™;
}

// â”€â”€ Render functions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderDashStats() {
var t=tot();
var ed=el(â€˜emgDisplayâ€™),dt=el(â€˜dashTotalâ€™),at=el(â€˜assetTotalâ€™);
if(ed) ed.textContent=â€™$â€™+Number(DB.emergencyFund||0).toLocaleString();
if(dt) dt.textContent=â€™$â€™+t.toLocaleString();
if(at) at.textContent=â€™$â€™+t.toLocaleString();
}

function renderDashYearly() {
var cont=el(â€˜dash-yearlyâ€™); if(!cont) return;
var items=(DB.plans_yearly||[]).slice(0,5);
if(!items.length){cont.innerHTML=â€™<p class="empty">å°šç„¡è¨ˆç•«ï¼Œå‰å¾€ã€Œè¨ˆç•«ã€é æ–°å¢</p>â€™;return;}
cont.innerHTML=items.map(function(p){
return â€˜<div style="margin-bottom:12px;"><div style="display:flex;justify-content:space-between;font-size:13px;font-weight:700;font-style:italic;margin-bottom:4px;"><span>â€™+esc(p.title)+â€™</span><span style="color:#60a5fa;">â€™+(p.progress||0)+â€™%</span></div><div class="pbar"><div class="pfil" style="width:'+(p.progress||0)+'%;"></div></div></div>â€™;
}).join(â€™â€™);
}

function renderYearly() {
var cont=el(â€˜yearlyListâ€™); if(!cont) return;
var items=DB.plans_yearly||[];
if(!items.length){cont.innerHTML=â€™<p class="empty">å°šç„¡é …ç›®ï¼Œé»æ“Š + æ–°å¢</p>â€™;return;}
cont.innerHTML=items.map(function(item,idx){
return â€˜<div class="ditem" draggable="true" data-drag-col="plans_yearly" data-drag-idx="'+idx+'">â€™
+â€™<span style="color:#475569;cursor:grab;flex-shrink:0;"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="12" r="1"/><circle cx="9" cy="5" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="19" r="1"/></svg></span>â€™
+â€™<div style="flex:1;min-width:0;"><p style="font-size:14px;font-weight:900;font-style:italic;color:#e2e8f0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">â€™+esc(item.title)+â€™</p></div>â€™
+â€™<input class="pinp" type="number" min="0" max="100" value="'+(item.progress||0)+'" data-act="prog" data-col="plans_yearly" data-id="'+item.id+'">â€™
+â€™<button class="bd" data-act="del" data-col="plans_yearly" data-id="'+item.id+'">â€™+trashSvg()+â€™</button>â€™
+â€™</div>â€™;
}).join(â€™â€™);
bindDrag(â€˜yearlyListâ€™,â€˜plans_yearlyâ€™);
}

function renderDaily() {
var cont=el(â€˜dailyListâ€™); if(!cont) return;
var items=DB.plans_daily||[];
if(!items.length){cont.innerHTML=â€™<p class="empty">å°šç„¡é …ç›®ï¼Œé»æ“Š + æ–°å¢</p>â€™;return;}
cont.innerHTML=items.map(function(item,idx){
return â€˜<div class="ditem" draggable="true" data-drag-col="plans_daily" data-drag-idx="'+idx+'">â€™
+â€™<span style="color:#475569;cursor:grab;flex-shrink:0;"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="12" r="1"/><circle cx="9" cy="5" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="19" r="1"/></svg></span>â€™
+â€™<div style="flex:1;min-width:0;"><p style="font-size:14px;font-weight:900;font-style:italic;color:#e2e8f0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">â€™+esc(item.title)+â€™</p></div>â€™
+â€™<button class="bd" data-act="del" data-col="plans_daily" data-id="'+item.id+'">â€™+trashSvg()+â€™</button>â€™
+â€™</div>â€™;
}).join(â€™â€™);
bindDrag(â€˜dailyListâ€™,â€˜plans_dailyâ€™);
}

function renderAssets() {
var cont=el(â€˜assetListâ€™); if(!cont) return;
var items=DB.assets||[];
if(!items.length){cont.innerHTML=â€™<p class="empty">å°šç„¡è³‡ç”¢</p>â€™;return;}
cont.innerHTML=items.map(function(a){
return â€˜<div class="aitem">â€™
+â€™<div style="flex:1;min-width:0;padding-right:9px;">â€™
+â€™<div style="font-size:13px;font-weight:900;color:#e2e8f0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">â€™+esc(a.name)+â€™</div>â€™
+â€™<div style="display:flex;gap:7px;margin-top:3px;align-items:center;">â€™
+â€™<span style="font-size:10px;color:#64748b;font-weight:900;text-transform:uppercase;">â€™+esc(a.category)+â€™</span>â€™
+â€™<span style="font-size:14px;font-weight:900;color:#60a5fa;font-style:italic;">$â€™+Number(a.amount).toLocaleString()+â€™</span>â€™
+â€™</div></div>â€™
+â€™<div style="display:flex;gap:2px;flex-shrink:0;">â€™
+â€™<button class="be" data-act="editAsset" data-id="'+a.id+'">â€™+editSvg()+â€™</button>â€™
+â€™<button class="bd" data-act="del" data-col="assets" data-id="'+a.id+'">â€™+trashSvg()+â€™</button>â€™
+â€™</div></div>â€™;
}).join(â€™â€™);
}

function renderHealthLogs() {
var cont=el(â€˜healthLogsâ€™); if(!cont) return;
var logs=(DB.health_logs||[]).slice().reverse().slice(0,10);
if(!logs.length){cont.innerHTML=â€™<p class="empty">å°šç„¡è¨˜éŒ„</p>â€™;return;}
cont.innerHTML=logs.map(function(l){
return â€˜<div style="display:flex;justify-content:space-between;align-items:center;padding:10px 13px;background:rgba(30,41,59,.2);border-radius:10px;margin-bottom:7px;border:1px solid #1e293b;gap:8px;">â€™
+â€™<span style="font-size:11px;color:#64748b;flex-shrink:0;">â€™+new Date(l.createdAt).toLocaleDateString(â€˜zh-TWâ€™)+â€™</span>â€™
+â€™<div style="display:flex;gap:9px;flex-wrap:wrap;flex:1;">â€™
+(l.weight?â€™<span style="font-size:12px;color:#3b82f6;font-weight:900;">é«”é‡ â€˜+l.weight+â€˜kg</span>â€™:â€™â€™)
+(l.fat?â€™<span style="font-size:12px;color:#ef4444;font-weight:900;">é«”è„‚ â€˜+l.fat+â€™%</span>â€™:â€™â€™)
+(l.muscle?â€™<span style="font-size:12px;color:#10b981;font-weight:900;">è‚Œè‚‰ â€˜+l.muscle+â€˜kg</span>â€™:â€™â€™)
+â€™</div>â€™
+â€™<button class="bd" data-act="del" data-col="health_logs" data-id="'+l.id+'">â€™+trashSvg()+â€™</button>â€™
+â€™</div>â€™;
}).join(â€™â€™);
}

function renderNotes(key) {
var cont=el(â€˜notes-â€™+key); if(!cont) return;
var items=DB[â€˜notes_â€™+key]||[];
if(!items.length){cont.innerHTML=â€™<p class="empty">å°šç„¡ç­†è¨˜</p>â€™;return;}
cont.innerHTML=items.map(function(n){
return â€˜<div class="nc">â€™
+â€™<button class="nhdr" data-act="toggleNote" data-nk="'+key+'" data-id="'+n.id+'">â€™
+â€™<span style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;padding-right:8px;">â€™+esc(n.title)+â€™</span>â€™
+â€™<span id="nc-'+key+'-'+n.id+'" style="color:#475569;flex-shrink:0;font-style:normal;">â–¾</span>â€™
+â€™</button>â€™
+â€™<div id="nb-'+key+'-'+n.id+'" class="nbody">â€™
+â€™<p style="white-space:pre-wrap;margin-bottom:11px;">â€™+esc(n.content||â€™â€™)+â€™</p>â€™
+â€™<div style="display:flex;justify-content:flex-end;gap:12px;">â€™
+â€™<button class="bsb" data-act="editNote" data-nk="'+key+'" data-id="'+n.id+'">ç·¨è¼¯</button>â€™
+â€™<button class="bsr" data-act="del" data-col="notes_'+key+'" data-id="'+n.id+'">åˆªé™¤</button>â€™
+â€™</div></div></div>â€™;
}).join(â€™â€™);
}

function renderTravel() {
var cont=el(â€˜travelListâ€™); if(!cont) return;
var items=DB.travel||[];
if(!items.length){cont.innerHTML=â€™<p class="empty">å°šç„¡è¡Œç¨‹ï¼Œé»æ“Š + æ–°å¢</p>â€™;return;}
cont.innerHTML=items.map(function(t){
return â€˜<div class="tcard">â€™
+â€™<div style="display:flex;align-items:center;gap:12px;">â€™
+â€™<div class="tico"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg></div>â€™
+â€™<div><p style="font-size:14px;font-weight:900;font-style:italic;color:#fff;">â€™+esc(t.destination)+â€™</p>â€™
+â€™<p style="font-size:11px;color:#64748b;font-weight:700;margin-top:3px;">â€™+esc(t.start)+â€™ ï½ â€˜+esc(t.end)+â€™</p></div>â€™
+â€™</div>â€™
+â€™<button class="bd" data-act="del" data-col="travel" data-id="'+t.id+'">â€™+trashSvg()+â€™</button>â€™
+â€™</div>â€™;
}).join(â€™â€™);
}

function trashSvg(){ return â€˜<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="pointer-events:none;"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>â€™; }
function editSvg(){ return â€˜<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="pointer-events:none;"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>â€™; }

function renderAll() {
drawRadar(); drawPie(â€˜pie-dashâ€™,â€˜leg-dashâ€™); drawPie(â€˜pie-assetâ€™,â€˜leg-assetâ€™);
renderDashStats(); renderDashYearly();
renderYearly(); renderDaily();
renderAssets(); renderHealthLogs(); drawHealth();
NKEYS.forEach(renderNotes);
renderTravel();
}

// â”€â”€ Drag & Drop (desktop) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function bindDrag(containerId, col) {
var cont = el(containerId); if(!cont) return;
var items = cont.querySelectorAll(â€™[data-drag-col=â€â€™+col+â€™â€]â€™);
for (var i=0; i<items.length; i++) {
(function(item) {
item.addEventListener(â€˜dragstartâ€™, function(e){ dragSrc=item; e.dataTransfer.effectAllowed=â€˜moveâ€™; });
item.addEventListener(â€˜dragoverâ€™,  function(e){ e.preventDefault(); item.className=â€˜ditem dovâ€™; });
item.addEventListener(â€˜dragleaveâ€™, function(){ item.className=â€˜ditemâ€™; });
item.addEventListener(â€˜dragendâ€™,   function(){ item.className=â€˜ditemâ€™; });
item.addEventListener(â€˜dropâ€™, function(e){
e.preventDefault(); item.className=â€˜ditemâ€™;
if(!dragSrc||dragSrc===item) return;
var fi=parseInt(dragSrc.getAttribute(â€˜data-drag-idxâ€™));
var ti=parseInt(item.getAttribute(â€˜data-drag-idxâ€™));
var arr=(DB[col]||[]).slice(), rm=arr.splice(fi,1);
arr.splice(ti,0,rm[0]); DB[col]=arr; ss(â€˜lm5â€™,DB); renderAll();
});
})(items[i]);
}
}

// â”€â”€ AI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function callAI(prompt, asJson) {
var url=â€˜https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=â€™+GK;
var body={contents:[{parts:[{text:prompt}]}]};
if(asJson) body.generationConfig={responseMimeType:â€˜application/jsonâ€™};
return fetch(url,{method:â€˜POSTâ€™,headers:{â€˜Content-Typeâ€™:â€˜application/jsonâ€™},body:JSON.stringify(body)})
.then(function(r){return r.json();})
.then(function(d){
try{return d.candidates[0].content.parts[0].text||â€™â€™;}catch(e){return â€˜â€™;}
});
}

function generateAI() {
if(aiOn) return; aiOn=true;
var btn=el(â€˜aiBtnâ€™) ? document.querySelector(â€™[data-act=â€œgenAIâ€]â€™) : null;
var sum=el(â€˜aiSumâ€™);
if(btn) btn.textContent=â€˜é‹ç®—ä¸­â€¦â€™;
var ctx=â€˜è³‡ç”¢ç¸½é¡ï¼šâ€™+tot().toLocaleString()+â€˜å…ƒï¼Œé…ç½®ï¼šâ€™+JSON.stringify(cats());
Promise.all([
callAI(â€˜åˆ†æäººç”Ÿæ•¸æ“šï¼Œå°è²¡å‹™ã€å¥åº·ã€è‡ªæˆ‘æˆé•·ã€åŸ·è¡ŒåŠ›ã€ç”Ÿæ´»é«”é©—å„è©•0-100åˆ†ï¼Œåªå›å‚³JSONï¼š{â€œwealthâ€:N,â€œhealthâ€:N,â€œgrowthâ€:N,â€œdisciplineâ€:N,â€œexperienceâ€:N}ã€‚è³‡æ–™ï¼šâ€™+ctx, true),
callAI(â€˜æ ¹æ“šè³‡æ–™ï¼šâ€™+ctx+â€™ï¼Œç”¨ç¹é«”ä¸­æ–‡ç´„150å­—çµ¦å‡ºäººç”Ÿæˆé•·èˆ‡ç†è²¡å»ºè­°ã€‚â€™, false)
]).then(function(res){
try{if(res[0]) radar=JSON.parse(res[0]);}catch(e){}
if(sum) sum.textContent=res[1]||â€˜AI åˆ†æå®Œæˆã€‚â€™;
drawRadar();
}).catch(function(){
if(sum) sum.textContent=â€˜AI åˆ†ææš«æ™‚ç„¡æ³•ä½¿ç”¨ï¼Œè«‹ç¢ºèªç¶²è·¯é€£ç·šã€‚â€™;
}).then(function(){ aiOn=false; if(btn) btn.textContent=â€˜é‡æ–°ç”¢ç”Ÿâ€™; });
}

function getAssetAI() {
if(aiOn) return; aiOn=true;
var btn=document.querySelector(â€™[data-act=â€œassetAIâ€]â€™);
var adv=el(â€˜assetAdvâ€™);
if(btn) btn.textContent=â€˜åˆ†æä¸­â€¦â€™;
callAI(â€˜åˆ†æè³‡ç”¢é…ç½®ï¼šâ€™+JSON.stringify(cats())+â€™ï¼Œç”¨ç¹é«”ä¸­æ–‡ç´„100å­—çµ¦å‡ºå…·é«”å„ªåŒ–å»ºè­°ã€‚â€™,false)
.then(function(r){if(adv) adv.textContent=r||â€˜åˆ†æå®Œæˆã€‚â€™;})
.catch(function(){if(adv) adv.textContent=â€˜AI åˆ†ææš«æ™‚ç„¡æ³•ä½¿ç”¨ã€‚â€™;})
.then(function(){aiOn=false;if(btn) btn.textContent=â€˜é–‹å§‹åˆ†æâ€™;});
}

function handleVoice() {
var SR=window.SpeechRecognition||window.webkitSpeechRecognition;
var btn=el(â€˜voiceBtnâ€™);
if(!SR){alert(â€˜èªéŸ³è¼¸å…¥éœ€è¦å…è¨±éº¥å…‹é¢¨ï¼Œæˆ–ä½¿ç”¨ Chrome ç€è¦½å™¨ã€‚â€™);return;}
var rec=new SR(); rec.lang=â€˜zh-TWâ€™; rec.start();
if(btn) btn.className=â€˜voice-btn onâ€™;
rec.onresult=function(ev){
var t=ev.results[0][0].transcript;
if(btn) btn.className=â€˜voice-btnâ€™;
callAI(â€˜Parse this voice input: â€˜+t+â€™. Return ONLY JSON: {â€œtypeâ€:â€œhealth_logsâ€,â€œdataâ€:{â€œweightâ€:number_or_null,â€œfatâ€:number_or_null,â€œmuscleâ€:number_or_null}}â€™,true)
.then(function(r){
try{
var p=JSON.parse(r);
if(!DB[p.type]) DB[p.type]=[];
DB[p.type].push(merge({id:uid(),createdAt:Date.now()},p.data));
ss(â€˜lm5â€™,DB); renderAll();
}catch(e){}
});
};
rec.onerror=function(){if(btn) btn.className=â€˜voice-btnâ€™;};
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
renderAll();
</script>

</body>
</html>
