<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Manager Pro - Ultra</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        body { background-color: #f8fafc; margin: 0; overflow: hidden; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .sidebar-icon { transition: all 0.2s; cursor: pointer; }
        .sidebar-icon:hover { color: #2563eb; transform: scale(1.1); }
        .active-nav { color: #2563eb; background-color: #eff6ff; border-radius: 12px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Firebase Configuration (已填入金鑰) ---
        const firebaseConfig = {
            apiKey: "AIzaSyAky6gF4ekVOuL0JiCr8ayBpD83wrLqe28",
            authDomain: "ai-jasonsu.firebaseapp.com",
            projectId: "ai-jasonsu",
            storageBucket: "ai-jasonsu.firebasestorage.app",
            messagingSenderId: "1061478494042",
            appId: "1:1061478494042:ios:9cd580ffa5fcec98eecd63"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = 'life-manager-pro-ultra';

        const Icon = ({ name, className = "w-5 h-5" }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        function App() {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [loading, setLoading] = useState(true);
            
            // 狀態定義 (完全對照原代碼)
            const [emergencyFund, setEmergencyFund] = useState(800000);
            const [plans, setPlans] = useState({ yearly: [], daily: [] });
            const [healthLogs, setHealthLogs] = useState([]);
            const [categoryAssets, setCategoryAssets] = useState([]);
            const [notes, setNotes] = useState({ life: [], book: [], trading: [], web: [] });
            const [travelLogs, setTravelLogs] = useState([]);
            const [workoutLogs, setWorkoutLogs] = useState([]);

            useEffect(() => {
                auth.signInAnonymously();
                const unsubscribe = auth.onAuthStateChanged(u => {
                    setUser(u);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;
                const uid = user.uid;
                const dataPath = (name) => db.collection('artifacts').doc(appId).collection('users').doc(uid).collection(name);

                const unsubs = [
                    dataPath('plans_yearly').onSnapshot(s => setPlans(p => ({ ...p, yearly: s.docs.map(d => ({ id: d.id, ...d.data() })) }))),
                    dataPath('plans_daily').onSnapshot(s => setPlans(p => ({ ...p, daily: s.docs.map(d => ({ id: d.id, ...d.data() })) }))),
                    dataPath('health').onSnapshot(s => setHealthLogs(s.docs.map(d => ({ id: d.id, ...d.data() })))),
                    dataPath('category_assets').onSnapshot(s => setCategoryAssets(s.docs.map(d => ({ id: d.id, ...d.data() })))),
                    dataPath('notes_life').onSnapshot(s => setNotes(n => ({ ...n, life: s.docs.map(d => ({ id: d.id, ...d.data() })) }))),
                    dataPath('notes_book').onSnapshot(s => setNotes(n => ({ ...n, book: s.docs.map(d => ({ id: d.id, ...d.data() })) }))),
                    dataPath('notes_trading').onSnapshot(s => setNotes(n => ({ ...n, trading: s.docs.map(d => ({ id: d.id, ...d.data() })) }))),
                    dataPath('notes_web').onSnapshot(s => setNotes(n => ({ ...n, web: s.docs.map(d => ({ id: d.id, ...d.data() })) }))),
                    dataPath('travel').onSnapshot(s => setTravelLogs(s.docs.map(d => ({ id: d.id, ...d.data() })))),
                    dataPath('workouts').onSnapshot(s => setWorkoutLogs(s.docs.map(d => ({ id: d.id, ...d.data() }))))
                ];
                return () => unsubs.forEach(u => u());
            }, [user]);

            const totalAssets = useMemo(() => categoryAssets.reduce((sum, a) => sum + Number(a.value || 0), 0), [categoryAssets]);

            if (loading) return <div className="flex items-center justify-center h-screen font-bold">Loading...</div>;

            return (
                <div className="flex h-screen w-screen bg-white overflow-hidden">
                    {/* 左側導覽列 (Side Navigation) */}
                    <nav className="w-16 flex flex-col items-center py-6 border-r border-gray-100 bg-white space-y-8 z-20">
                        <div className="text-blue-600 mb-4"><Icon name="zap" className="w-8 h-8" /></div>
                        
                        <button onClick={() => setActiveTab('dashboard')} className={`p-2 sidebar-icon ${activeTab === 'dashboard' ? 'active-nav' : 'text-gray-400'}`}>
                            <Icon name="layout-dashboard" />
                        </button>
                        <button onClick={() => setActiveTab('plans')} className={`p-2 sidebar-icon ${activeTab === 'plans' ? 'active-nav' : 'text-gray-400'}`}>
                            <Icon name="calendar" />
                        </button>
                        <button onClick={() => setActiveTab('health')} className={`p-2 sidebar-icon ${activeTab === 'health' ? 'active-nav' : 'text-gray-400'}`}>
                            <Icon name="heart" />
                        </button>
                        <button onClick={() => setActiveTab('assets')} className={`p-2 sidebar-icon ${activeTab === 'assets' ? 'active-nav' : 'text-gray-400'}`}>
                            <Icon name="pie-chart" />
                        </button>
                        <button onClick={() => setActiveTab('notes')} className={`p-2 sidebar-icon ${activeTab === 'notes' ? 'active-nav' : 'text-gray-400'}`}>
                            <Icon name="book" />
                        </button>
                        <button onClick={() => setActiveTab('travel')} className={`p-2 sidebar-icon ${activeTab === 'travel' ? 'active-nav' : 'text-gray-400'}`}>
                            <Icon name="map" />
                        </button>

                        <div className="mt-auto flex flex-col gap-4 pb-4 text-gray-400">
                            <button className="sidebar-icon"><Icon name="download" className="w-5 h-5" /></button>
                            <button className="sidebar-icon"><Icon name="upload" className="w-5 h-5" /></button>
                        </div>
                    </nav>

                    {/* 右側主要內容區 */}
                    <div className="flex-1 flex flex-col overflow-hidden">
                        <header className="h-16 flex items-center justify-between px-6 border-b bg-white">
                            <h1 className="text-xl font-bold text-gray-800 capitalize">{activeTab}</h1>
                            <div className="flex items-center gap-4">
                                <button className="p-2 bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                                    <Icon name="plus" className="w-5 h-5" />
                                </button>
                                <Icon name="user" className="text-gray-400" />
                            </div>
                        </header>

                        <main className="flex-1 overflow-y-auto p-6 space-y-6 no-scrollbar bg-slate-50">
                            {activeTab === 'dashboard' && (
                                <div className="max-w-4xl space-y-6">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className="p-6 bg-blue-600 text-white rounded-3xl shadow-xl">
                                            <p className="opacity-80 text-sm">緊急預備金</p>
                                            <h2 className="text-3xl font-black mt-1">${emergencyFund.toLocaleString()}</h2>
                                        </div>
                                        <div className="p-6 bg-slate-900 text-white rounded-3xl shadow-xl">
                                            <p className="opacity-60 text-sm">資產總計</p>
                                            <h2 className="text-3xl font-black mt-1 text-blue-400">${totalAssets.toLocaleString()}</h2>
                                        </div>
                                    </div>
                                    
                                    <div className="p-6 bg-white rounded-3xl border border-gray-100 shadow-sm">
                                        <h3 className="font-bold text-gray-700 mb-4">資產明細</h3>
                                        {categoryAssets.map(a => (
                                            <div key={a.id} className="flex justify-between py-3 border-b border-gray-50 last:border-0">
                                                <span className="text-gray-600">{a.name}</span>
                                                <span className="font-mono font-bold text-gray-800">${Number(a.value).toLocaleString()}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'plans' && (
                                <div className="max-w-4xl bg-white p-6 rounded-3xl border border-gray-100 shadow-sm">
                                    <h3 className="font-bold text-gray-700 mb-4">年度計畫進度</h3>
                                    {plans.yearly.map(p => (
                                        <div key={p.id} className="mb-4">
                                            <div className="flex justify-between mb-1 text-sm font-bold">
                                                <span>{p.title}</span>
                                                <span className="text-blue-600">{p.progress}%</span>
                                            </div>
                                            <div className="w-full bg-gray-100 h-2 rounded-full overflow-hidden">
                                                <div className="bg-blue-600 h-full" style={{ width: `${p.progress}%` }}></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </main>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
