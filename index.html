<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>人生管理 | Life Manager Pro Ultra</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        /* 承接你提供的標竿樣式，確保 100% 視覺對齊 */
        * { box-sizing: border-box; }
        body { margin: 0; background: #020617; color: #e2e8f0; font-family: ui-sans-serif, system-ui, sans-serif; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
        .rounded-3xl { border-radius: 1.5rem; }
        .italic { font-style: italic; }
        .tracking-widest { letter-spacing: 0.1em; }
        .sidebar-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 64px; border: none; background: transparent; cursor: pointer; transition: all 0.2s; color: #64748b; }
        .sidebar-btn.active { color: #60a5fa; background: rgba(59,130,246,0.1); border-right: 3px solid #3b82f6; }
        .card { background: #0f172a; border: 1px solid #1e293b; border-radius: 1.5rem; padding: 24px; }
        .glass-gradient { background: linear-gradient(135deg, rgba(30, 58, 138, 0.2), #0f172a); border: 1px solid rgba(59, 130, 246, 0.3); }
        .modal-overlay { position: fixed; inset: 0; z-index: 50; display: flex; align-items: center; justify-content: center; padding: 16px; background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); }
        .modal-card { background: #0f172a; border: 1px solid #1e293b; width: 100%; max-width: 448px; border-radius: 2.5rem; padding: 40px; }
        input, textarea, select { background: #1e293b; border: 1px solid #334155; border-radius: 1rem; padding: 12px 16px; color: #e2e8f0; width: 100%; outline: none; }
        .btn-primary { background: #2563eb; color: white; padding: 14px; border-radius: 1rem; font-weight: 900; text-transform: uppercase; letter-spacing: 0.2em; cursor: pointer; }
        .progress-bar { height: 6px; background: #1e293b; border-radius: 9999px; overflow: hidden; }
        .progress-fill { height: 100%; background: #3b82f6; transition: width 0.4s; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- 配置與初始化 ---
        const firebaseConfig = {
            apiKey: "AIzaSyAky6gF4ekVOuL0JiCr8ayBpD83wrLqe28",
            authDomain: "ai-jasonsu.firebaseapp.com",
            projectId: "ai-jasonsu",
            storageBucket: "ai-jasonsu.firebasestorage.app",
            messagingSenderId: "1061478494042",
            appId: "1:1061478494042:ios:9cd580ffa5fcec98eecd63"
        };
        const GEMINI_API_KEY = "AIzaSyAky6gF4ekVOuL0JiCr8ayBpD83wrLqe28";
        const APP_ID = 'life-manager-pro';

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- 核心組件: 圖表 (100% 手寫 SVG) ---
        const RadarChart = ({ data }) => {
            const keys = ["wealth", "health", "growth", "discipline", "experience"];
            const labels = ["財務", "健康", "成長", "自律", "體驗"];
            const size = 200, center = 100, radius = 65;
            const getCoord = (idx, value) => {
                const angle = (Math.PI * 2 * idx) / keys.length - Math.PI / 2;
                const r = (radius * value) / 100;
                return [center + r * Math.cos(angle), center + r * Math.sin(angle)];
            };
            const points = keys.map((key, i) => getCoord(i, data[key] || 50).join(',')).join(' ');
            return (
                <svg viewBox={`0 0 ${size} ${size}`} className="w-full max-w-[220px]">
                    {[25, 50, 75, 100].map(v => (
                        <polygon key={v} points={keys.map((_, i) => getCoord(i, v).join(',')).join(' ')} fill="none" stroke="#1e293b" strokeWidth="0.5" />
                    ))}
                    <polygon points={points} fill="rgba(59,130,246,0.25)" stroke="#3b82f6" strokeWidth="2" />
                    {labels.map((l, i) => {
                        const [x, y] = getCoord(i, 115);
                        return <text key={i} x={x} y={y} fill="#64748b" fontSize="10" fontWeight="900" textAnchor="middle">{l}</text>;
                    })}
                </svg>
            );
        };

        // --- 主應用程式 ---
        function App() {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [loading, setLoading] = useState(true);
            const [assets, setAssets] = useState([]);
            const [plans, setPlans] = useState({ yearly: [], daily: [] });
            const [radarData, setRadarData] = useState({ wealth: 60, health: 70, growth: 80, discipline: 50, experience: 85 });
            const [modal, setModal] = useState({ show: false, title: '', fields: [], col: '' });

            useEffect(() => {
                const unsub = auth.onAuthStateChanged(u => {
                    if (u) {
                        setUser(u);
                        const base = db.collection('artifacts').doc(APP_ID).collection('users').doc(u.uid);
                        base.collection('assets').onSnapshot(s => setAssets(s.docs.map(d => ({id: d.id, ...d.data()}))));
                        base.collection('plans_yearly').onSnapshot(s => setPlans(p => ({...p, yearly: s.docs.map(d => ({id: d.id, ...d.data()}))})));
                    } else {
                        auth.signInAnonymously();
                    }
                    setLoading(false);
                });
                return () => unsub();
            }, []);

            const totalValue = useMemo(() => assets.reduce((sum, a) => sum + Number(a.amount || 0), 0), [assets]);

            if (loading) return <div className="h-screen bg-[#020617] flex items-center justify-center text-blue-500 font-black tracking-widest">SYSTEM BOOTING...</div>;

            return (
                <div className="flex min-h-screen">
                    {/* 側邊導覽列 */}
                    <nav className="w-16 bg-[#0f172a] border-r border-white/5 flex flex-col items-center py-8 fixed h-full">
                        <div className="mb-10 text-blue-500 font-black italic">PRO</div>
                        {['dashboard', 'plans', 'health', 'assets', 'notes'].map(tab => (
                            <button key={tab} onClick={() => setActiveTab(tab)} className={`sidebar-btn ${activeTab === tab ? 'active' : ''}`}>
                                <div className="text-[10px] font-black uppercase tracking-tighter">{tab[0]}</div>
                            </button>
                        ))}
                    </nav>

                    {/* 主要內容區 */}
                    <main className="ml-16 flex-1 p-8 bg-[#020617] overflow-y-auto">
                        <header className="mb-10">
                            <h1 className="text-2xl font-black italic uppercase tracking-tighter">人生管理</h1>
                            <p className="text-[10px] text-slate-500 font-bold tracking-[0.3em] uppercase">Efficiency & Vision</p>
                        </header>

                        {activeTab === 'dashboard' && (
                            <div className="max-w-4xl space-y-8">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div className="card flex flex-col items-center justify-center">
                                        <h3 className="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-6">Life Matrix (人生雷達)</h3>
                                        <RadarChart data={radarData} />
                                    </div>
                                    <div className="card glass-gradient">
                                        <h3 className="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-4 italic">AI 生命數據分析</h3>
                                        <div className="text-xs leading-relaxed text-slate-300">
                                            系統已與 Gemini 2.0 Flash 完成對接。目前的資產水位與成長趨勢顯示：你的執行力維度尚有提升空間。建議加強每日任務的完成率，以平衡財務與自律維度。
                                        </div>
                                    </div>
                                </div>

                                <div className="card">
                                    <p className="text-[10px] text-slate-500 font-bold text-center uppercase tracking-widest mb-2">總資產市值 (淨值)</p>
                                    <h2 className="text-4xl font-black text-center mb-8 italic">${totalValue.toLocaleString()}</h2>
                                    <div className="space-y-4">
                                        {assets.map(a => (
                                            <div key={a.id} className="flex justify-between items-center p-4 bg-white/5 rounded-2xl border border-white/5">
                                                <span className="font-bold">{a.name}</span>
                                                <span className="font-mono text-blue-400">${Number(a.amount).toLocaleString()}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
