<!DOCTYPE html>

<html lang="zh-TW">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<title>äººç”Ÿç®¡ç† | Life Manager Pro</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{background:#020617;color:#e2e8f0;font-family:-apple-system,BlinkMacSystemFont,'Helvetica Neue',Arial,sans-serif;min-height:100vh;font-size:15px;}
::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-thumb{background:#1e293b;border-radius:10px;}
@-webkit-keyframes fadeIn{from{opacity:0;-webkit-transform:translateY(8px);transform:translateY(8px)}to{opacity:1;-webkit-transform:none;transform:none}}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@-webkit-keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

/* â”€â”€ Layout â”€â”€ */
.app{display:flex;min-height:100vh;}
.sidebar{position:fixed;left:0;top:0;bottom:0;width:64px;background:#0f172a;border-right:1px solid #1e293b;display:flex;flex-direction:column;align-items:center;padding:20px 0;z-index:100;}
.main{margin-left:64px;padding:26px 22px;width:calc(100% - 64px);min-height:100vh;overflow-y:auto;-webkit-overflow-scrolling:touch;}

/* â”€â”€ Nav â”€â”€ */
.nav-btn{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:54px;border:none;background:transparent;cursor:pointer;color:#64748b;border-right:3px solid transparent;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}
.nav-btn.active{color:#60a5fa;background:rgba(59,130,246,0.12);border-right-color:#3b82f6;}
.nav-btn svg{width:20px;height:20px;pointer-events:none;}
.nav-label{font-size:9px;margin-top:4px;font-weight:900;text-transform:uppercase;letter-spacing:.05em;pointer-events:none;}
.voice-btn{margin-top:auto;margin-bottom:12px;width:40px;height:40px;border-radius:50%;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;background:#1e293b;color:#94a3b8;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}
.voice-btn.listening{background:#ef4444;color:#fff;-webkit-animation:pulse 1.5s infinite;animation:pulse 1.5s infinite;}

/* â”€â”€ Cards â”€â”€ */
.card{background:#0f172a;border:1px solid #1e293b;border-radius:18px;padding:20px;}
.total-card{background:#0f172a;border:1px solid #1e293b;border-radius:24px;padding:26px;text-align:center;}
.ai-panel{background:linear-gradient(135deg,rgba(23,37,84,.5),#0f172a);border:1px solid rgba(59,130,246,.3);border-radius:18px;padding:18px;}
.ai-panel-green{background:#0f172a;border:1px solid rgba(16,185,129,.3);border-radius:16px;padding:16px;}

/* â”€â”€ Grid â”€â”€ */
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.grid-asset{display:grid;grid-template-columns:1.4fr 1fr;gap:16px;}

/* â”€â”€ Pages â€” KEY: only display:none vs display:flex â”€â”€ */
.page{display:none;}
.page.active{display:flex;flex-direction:column;gap:16px;-webkit-animation:fadeIn .2s ease;animation:fadeIn .2s ease;}

/* â”€â”€ Typography â”€â”€ */
.section-title{font-size:13px;font-weight:900;font-style:italic;text-transform:uppercase;letter-spacing:.1em;color:#94a3b8;}
.label-xs{font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.14em;color:#64748b;}
.empty-msg{color:#475569;font-size:14px;font-style:italic;text-align:center;padding:18px 0;}
.header-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;}

/* â”€â”€ Buttons â”€â”€ */
.btn-blue{background:#2563eb;color:#fff;border:none;border-radius:10px;padding:9px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}
.btn-green{background:#059669;color:#fff;border:none;border-radius:10px;padding:9px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}
.btn-ghost{background:rgba(59,130,246,.15);color:#60a5fa;border:1px solid rgba(59,130,246,.3);border-radius:8px;padding:7px 13px;font-size:11px;font-weight:900;cursor:pointer;white-space:nowrap;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}
.btn-ghost-green{background:rgba(16,185,129,.1);color:#34d399;border:1px solid rgba(16,185,129,.25);border-radius:8px;padding:7px 13px;font-size:11px;font-weight:900;cursor:pointer;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}
.btn-del{background:none;border:none;color:#475569;cursor:pointer;padding:5px;display:inline-flex;align-items:center;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}
.btn-del:active{color:#ef4444;}
.btn-edit{background:none;border:none;color:#475569;cursor:pointer;padding:5px;display:inline-flex;align-items:center;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}
.btn-edit:active{color:#60a5fa;}
.btn-sm-blue{background:none;border:none;font-size:11px;font-weight:900;text-transform:uppercase;cursor:pointer;color:#60a5fa;padding:0;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}
.btn-sm-red{background:none;border:none;font-size:11px;font-weight:900;text-transform:uppercase;cursor:pointer;color:#ef4444;padding:0;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}

/* â”€â”€ Items â”€â”€ */
.asset-item{padding:12px 14px;background:rgba(30,41,59,.25);border:1px solid #1e293b;border-radius:12px;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.drag-item{padding:12px 14px;background:rgba(30,41,59,.2);border:1px solid #1e293b;border-radius:12px;display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.drag-item.drag-over{opacity:.3;border-color:#3b82f6;}
.note-card{background:rgba(30,41,59,.2);border:1px solid #1e293b;border-radius:12px;overflow:hidden;margin-bottom:8px;}
.note-hdr{width:100%;padding:12px 14px;display:flex;justify-content:space-between;align-items:center;background:none;border:none;color:#e2e8f0;cursor:pointer;font-size:13px;font-weight:900;font-style:italic;text-align:left;font-family:inherit;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}
.note-body{padding:14px;border-top:1px solid rgba(30,41,59,.6);background:rgba(2,6,23,.4);font-size:13px;color:#94a3b8;line-height:1.65;display:none;}
.note-body.open{display:block;}
.prog-bar{height:5px;background:#1e293b;border-radius:9999px;overflow:hidden;margin-top:4px;}
.prog-fill{height:100%;background:#3b82f6;border-radius:9999px;}
.prog-input{width:46px;text-align:center;font-size:12px;font-weight:900;color:#60a5fa;padding:3px;background:#020617;border:1px solid #334155;border-radius:6px;font-family:inherit;}
.travel-card{padding:15px;background:rgba(30,41,59,.2);border:1px solid #1e293b;border-radius:16px;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.travel-icon{padding:9px;background:rgba(16,185,129,.1);border-radius:10px;color:#10b981;display:flex;}

/* â”€â”€ Modal â”€â”€ */
.modal-wrap{position:fixed;inset:0;z-index:300;display:none;align-items:center;justify-content:center;padding:16px;}
.modal-wrap.open{display:flex;}
.modal-bg{position:absolute;inset:0;background:rgba(0,0,0,.85);}
.modal-box{position:relative;background:#0f172a;border:1px solid #1e293b;width:100%;max-width:420px;border-radius:28px;padding:32px;box-shadow:0 30px 60px rgba(0,0,0,.7);z-index:1;max-height:90vh;overflow-y:auto;-webkit-overflow-scrolling:touch;}
.modal-title{font-size:18px;font-weight:900;font-style:italic;text-transform:uppercase;letter-spacing:-.03em;color:#fff;margin-bottom:22px;}
.close-btn{position:absolute;top:14px;right:14px;background:#1e293b;border:none;color:#64748b;cursor:pointer;width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}
.form-group{display:flex;flex-direction:column;gap:6px;margin-bottom:14px;}
.form-group label{font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.14em;color:#64748b;}
.form-group input,.form-group textarea{background:#1e293b;border:1px solid #334155;border-radius:11px;padding:12px 15px;font-size:15px;color:#e2e8f0;outline:none;width:100%;font-family:inherit;-webkit-appearance:none;appearance:none;}
.form-group input[type=â€œdateâ€]{color-scheme:dark;}
.form-group textarea{height:100px;resize:vertical;}
.btn-submit{width:100%;padding:14px;background:#2563eb;color:#fff;border:none;border-radius:12px;font-size:13px;font-weight:900;text-transform:uppercase;letter-spacing:.18em;cursor:pointer;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}

/* â”€â”€ Responsive â”€â”€ */
@media(max-width:700px){
.grid-2{grid-template-columns:1fr;}
.grid-asset{grid-template-columns:1fr;}
.main{margin-left:0;padding:14px 14px 76px;width:100%;}
.sidebar{width:100%;height:60px;top:auto;bottom:0;flex-direction:row;border-right:none;border-top:1px solid #1e293b;padding:0;justify-content:space-around;}
.nav-btn{height:60px;width:auto;border-right:none;border-top:3px solid transparent;flex:1;padding:0 4px;}
.nav-btn.active{border-top-color:#3b82f6;border-right:none;background:rgba(59,130,246,.1);}
.voice-btn{margin:0;flex-shrink:0;}
}
</style>

</head>
<body>
<div class="app">

<!-- â•â• Sidebar â•â• -->

<nav class="sidebar">
  <div style="margin-bottom:20px;color:#3b82f6;flex-shrink:0;">
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96-.46 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96-.46 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>
  </div>
  <button class="nav-btn active" id="nb-dashboard">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>
    <span class="nav-label">ç¸½è¦½</span>
  </button>
  <button class="nav-btn" id="nb-plans">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
    <span class="nav-label">è¨ˆç•«</span>
  </button>
  <button class="nav-btn" id="nb-health">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
    <span class="nav-label">å¥åº·</span>
  </button>
  <button class="nav-btn" id="nb-assets">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>
    <span class="nav-label">è³‡ç”¢</span>
  </button>
  <button class="nav-btn" id="nb-notes">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
    <span class="nav-label">ç­†è¨˜</span>
  </button>
  <button class="nav-btn" id="nb-travel">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" y1="3" x2="9" y2="18"/><line x1="15" y1="6" x2="15" y2="21"/></svg>
    <span class="nav-label">æ—…éŠ</span>
  </button>
  <button class="voice-btn" id="voiceBtn">
    <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/></svg>
  </button>
</nav>

<!-- â•â• Main â•â• -->

<main class="main">
  <div style="margin-bottom:22px;">
    <h1 style="font-size:23px;font-weight:900;color:#fff;font-style:italic;text-transform:uppercase;letter-spacing:-.04em;">äººç”Ÿç®¡ç†</h1>
    <p class="label-xs" style="margin-top:4px;">Efficiency &amp; Vision</p>
  </div>

  <!-- Dashboard -->

  <div id="pg-dashboard" class="page active">
    <div class="grid-2">
      <div class="card" style="align-items:center;gap:12px;display:flex;flex-direction:column;">
        <p style="font-size:11px;font-weight:900;color:#60a5fa;text-transform:uppercase;letter-spacing:.13em;font-style:italic;">â¬¡ äººç”Ÿé›·é”åœ–</p>
        <svg id="radarSvg" viewBox="0 0 200 200" style="width:100%;max-width:190px;display:block;"></svg>
      </div>
      <div class="ai-panel" style="display:flex;flex-direction:column;gap:11px;">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <span style="font-size:11px;font-weight:900;color:#60a5fa;text-transform:uppercase;letter-spacing:.07em;font-style:italic;">âœ¦ AI ç”Ÿå‘½åˆ†æ</span>
          <button class="btn-ghost" id="aiBtn">é‡æ–°ç”¢ç”Ÿ</button>
        </div>
        <p id="aiSummary" style="font-size:13px;color:#cbd5e1;line-height:1.7;white-space:pre-wrap;flex:1;min-height:60px;">é»æ“Šã€Œé‡æ–°ç”¢ç”Ÿã€å–å¾— AI å°ˆå±¬åˆ†æ...</p>
      </div>
    </div>
    <div class="card">
      <p class="section-title" style="margin-bottom:13px;">ğŸ“… å¹´åº¦ç›®æ¨™é€²åº¦</p>
      <div id="dash-yearly"></div>
    </div>
    <div class="total-card">
      <p class="label-xs">ç¸½è³‡ç”¢å¸‚å€¼ï¼ˆæ·¨å€¼ï¼‰</p>
      <div id="dashTotal" style="font-size:34px;font-weight:900;color:#fff;font-style:italic;margin:8px 0 20px;"></div>
      <svg id="pieSvgDash" viewBox="-1.15 -1.15 2.3 2.3" style="transform:rotate(-90deg);width:100%;max-width:210px;height:auto;display:block;margin:0 auto;"></svg>
      <div id="pieLegDash" style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:13px;"></div>
      <div style="margin-top:20px;padding-top:18px;border-top:1px solid #1e293b;display:flex;justify-content:space-between;align-items:center;">
        <div>
          <p class="label-xs">ç·Šæ€¥é å‚™é‡‘</p>
          <p id="emergencyDisplay" style="font-size:21px;font-weight:900;color:#60a5fa;font-style:italic;margin-top:4px;">$0</p>
        </div>
        <button class="btn-ghost" id="emergencyBtn">ä¿®æ”¹é‡‘é¡</button>
      </div>
    </div>
  </div>

  <!-- Plans -->

  <div id="pg-plans" class="page">
    <div class="card">
      <div class="header-row">
        <span class="section-title">å¹´åº¦ç›®æ¨™è¨ˆç•«</span>
        <button class="btn-blue" id="addYearlyBtn"><svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
      </div>
      <div id="yearlyList"></div>
    </div>
    <div class="card">
      <div class="header-row">
        <span class="section-title">æ¯æ—¥ä»»å‹™ç®¡ç†</span>
        <button class="btn-blue" id="addDailyBtn"><svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
      </div>
      <div id="dailyList"></div>
    </div>
  </div>

  <!-- Health -->

  <div id="pg-health" class="page">
    <div class="card">
      <div class="header-row">
        <span class="section-title">å¥åº·æ•¸æ“šè¶¨å‹¢</span>
        <button class="btn-blue" id="addHealthBtn"><svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
      </div>
      <div id="healthChart"></div>
      <p class="label-xs" style="margin:15px 0 9px;">æ­·å²è¨˜éŒ„</p>
      <div id="healthLogs"></div>
    </div>
  </div>

  <!-- Assets -->

  <div id="pg-assets" class="page">
    <div class="ai-panel-green">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:9px;">
        <span style="font-size:11px;font-weight:900;color:#34d399;text-transform:uppercase;letter-spacing:.07em;">â“˜ AI è³‡ç”¢é…ç½®å»ºè­°</span>
        <button class="btn-ghost-green" id="assetAiBtn">é–‹å§‹åˆ†æ</button>
      </div>
      <p id="assetAdvice" style="font-size:13px;color:#94a3b8;line-height:1.6;font-style:italic;">é»æ“Šã€Œé–‹å§‹åˆ†æã€ï¼ŒAI å°‡æä¾›è³‡ç”¢é…ç½®å„ªåŒ–å»ºè­°ã€‚</p>
    </div>
    <div class="grid-asset">
      <div class="total-card" style="border-radius:22px;">
        <p class="label-xs">ç¸½è³‡ç”¢å¸‚å€¼</p>
        <div id="assetTotal" style="font-size:26px;font-weight:900;color:#fff;font-style:italic;margin:7px 0 17px;"></div>
        <svg id="pieSvgAsset" viewBox="-1.15 -1.15 2.3 2.3" style="transform:rotate(-90deg);width:100%;max-width:190px;height:auto;display:block;margin:0 auto;"></svg>
        <div id="pieLegAsset" style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:11px;"></div>
      </div>
      <div class="card">
        <div class="header-row">
          <span class="section-title">è³‡ç”¢æ˜ç´°</span>
          <button class="btn-blue" id="addAssetBtn"><svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
        </div>
        <div id="assetList"></div>
      </div>
    </div>
  </div>

  <!-- Notes -->

  <div id="pg-notes" class="page">
    <div class="grid-2">
      <div class="card"><div class="header-row"><span class="label-xs">äººç”Ÿæˆé•·</span><button class="btn-blue" id="addNoteLifeBtn" style="padding:7px;"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="notes-life"></div></div>
      <div class="card"><div class="header-row"><span class="label-xs">æ›¸ç±é‡é»</span><button class="btn-blue" id="addNoteBookBtn" style="padding:7px;"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="notes-book"></div></div>
      <div class="card"><div class="header-row"><span class="label-xs">å°æŒ‡äº¤æ˜“</span><button class="btn-blue" id="addNoteTradingBtn" style="padding:7px;"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="notes-trading"></div></div>
      <div class="card"><div class="header-row"><span class="label-xs">ç¶²è·¯å¿ƒå¾—</span><button class="btn-blue" id="addNoteWebBtn" style="padding:7px;"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div id="notes-web"></div></div>
    </div>
  </div>

  <!-- Travel -->

  <div id="pg-travel" class="page">
    <div class="card">
      <div class="header-row">
        <span class="section-title">æ—…éŠé¡˜æœ›èˆ‡è¡Œç¨‹</span>
        <button class="btn-green" id="addTravelBtn"><svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
      </div>
      <div id="travelList"></div>
    </div>
  </div>
</main>
</div>

<!-- â•â• Modal â•â• -->

<div class="modal-wrap" id="modalWrap">
  <div class="modal-bg" id="modalBg"></div>
  <div class="modal-box">
    <button class="close-btn" id="closeModalBtn"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
    <div id="modalTitle" class="modal-title"></div>
    <form id="modalForm"><div id="modalFields"></div><button type="submit" class="btn-submit">ç¢ºèªé€å‡º</button></form>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIFE MANAGER PRO â€” Safari-safe edition
   Rules:
   1. Only addEventListener('click') â€” no onclick attrs, no touchend
   2. className string assignment (no classList.add/remove for page switching)
   3. No async/await â€” Promise chains only
   4. No spread â€” Object.assign only
   5. No arrow functions in IE-sensitive paths (optional but safe)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

var GK = 'AIzaSyAky6gF4ekVOuL0JiCr8ayBpD83wrLqe28';
var PIE_COLORS = ['#3b82f6','#10b981','#f59e0b','#ef4444','#8b5cf6'];
var TABS = ['dashboard','plans','health','assets','notes','travel'];
var NOTE_KEYS = ['life','book','trading','web'];

// â”€â”€ Storage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function dbLoad() {
  try { return JSON.parse(localStorage.getItem('lm4') || '{}'); } catch(e) { return {}; }
}
function dbSave(d) {
  try { localStorage.setItem('lm4', JSON.stringify(d)); } catch(e) {}
}
function uid() { return '_' + Math.random().toString(36).slice(2) + Date.now().toString(36); }
function esc(s) {
  return String(s == null ? '' : s)
    .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

var DB = dbLoad();
var radarVals = {wealth:50,health:50,growth:50,discipline:50,experience:50};
var aiRunning = false;
var dragSrc = null;
var mMeta = {};

// Default assets
if (!DB.assets || !DB.assets.length) {
  DB.assets = [
    {id:uid(),name:'å°è‚¡',amount:2544261,category:'å°è‚¡',createdAt:Date.now()},
    {id:uid(),name:'ç¾è‚¡',amount:829175,category:'ç¾è‚¡',createdAt:Date.now()},
    {id:uid(),name:'å°æ–°å¤–å¹£(æ´»)-USD',amount:4257,category:'ç¾è‚¡',createdAt:Date.now()},
    {id:uid(),name:'å°æ–°å¤–å¹£(æ´»)-JPY',amount:6006,category:'ç¾é‡‘',createdAt:Date.now()},
    {id:uid(),name:'å°æ–°å¤–å¹£(å®š)-USD',amount:75473,category:'ç¾è‚¡',createdAt:Date.now()},
    {id:uid(),name:'åˆåº«(æ´»å­˜)',amount:1357878,category:'ç¾é‡‘',createdAt:Date.now()},
    {id:uid(),name:'å°æ–°(æ´»å­˜)',amount:57170,category:'ç¾é‡‘',createdAt:Date.now()},
    {id:uid(),name:'å½°éŠ€(æ´»å­˜)',amount:457003,category:'ç¾é‡‘',createdAt:Date.now()},
    {id:uid(),name:'å…†è±(å‚™ç”¨é‡‘)',amount:43314,category:'ç¾é‡‘',createdAt:Date.now()},
    {id:uid(),name:'é»ƒé‡‘(2.2ç›å¸)',amount:357357,category:'é»ƒé‡‘',createdAt:Date.now()},
    {id:uid(),name:'å°å¹£ç¾é‡‘',amount:20000,category:'ç¾é‡‘',createdAt:Date.now()},
    {id:uid(),name:'å€Ÿå¿—',amount:300000,category:'å€Ÿæ¬¾',createdAt:Date.now()}
  ];
  dbSave(DB);
}

// â”€â”€ Tab switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CRITICAL: use className = string, not classList, for maximum Safari compat
function showTab(id) {
  TABS.forEach(function(t) {
    var pg = document.getElementById('pg-' + t);
    var nb = document.getElementById('nb-' + t);
    if (pg) pg.className = (t === id) ? 'page active' : 'page';
    if (nb) nb.className = (t === id) ? 'nav-btn active' : 'nav-btn';
  });
  renderAll();
}

TABS.forEach(function(t) {
  var btn = document.getElementById('nb-' + t);
  if (btn) btn.addEventListener('click', function() { showTab(t); });
});

// â”€â”€ Asset helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function catData() {
  var c = {å°è‚¡:0,ç¾è‚¡:0,ç¾é‡‘:0,é»ƒé‡‘:0,å€Ÿæ¬¾:0};
  (DB.assets || []).forEach(function(a) {
    var cat = a.category || 'ç¾é‡‘';
    c[cat] = (c[cat] || 0) + (Number(a.amount) || 0);
  });
  return Object.keys(c).map(function(k) { return {name:k, amount:c[k]}; });
}
function total() { return catData().reduce(function(s,x) { return s + x.amount; }, 0); }

// â”€â”€ Pie chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawPie(svgId, legId) {
  var svg = document.getElementById(svgId);
  var leg = document.getElementById(legId);
  if (!svg) return;
  svg.innerHTML = '';
  var data = catData();
  var tot = total();
  if (!tot) return;
  var cum = 0;
  function pt(p) { return [Math.cos(2*Math.PI*p), Math.sin(2*Math.PI*p)]; }
  data.forEach(function(d, i) {
    var pct = d.amount / tot;
    if (pct <= 0) return;
    var a0 = cum, a1, p0 = pt(a0), p1, pm;
    cum += pct; a1 = cum;
    p1 = pt(a1); pm = pt(a0 + pct/2);
    var large = pct > 0.5 ? 1 : 0;
    var el = document.createElementNS('http://www.w3.org/2000/svg','path');
    el.setAttribute('d','M'+p0[0]+' '+p0[1]+' A1 1 0 '+large+' 1 '+p1[0]+' '+p1[1]+' L0 0');
    el.setAttribute('fill', PIE_COLORS[i % PIE_COLORS.length]);
    el.setAttribute('stroke','#020617'); el.setAttribute('stroke-width','0.025');
    svg.appendChild(el);
    if (pct > 0.07) {
      var tx = document.createElementNS('http://www.w3.org/2000/svg','text');
      var x = pm[0]*0.67, y = pm[1]*0.67;
      tx.setAttribute('x',x); tx.setAttribute('y',y);
      tx.setAttribute('fill','#fff'); tx.setAttribute('font-size','0.115');
      tx.setAttribute('font-weight','bold'); tx.setAttribute('text-anchor','middle');
      tx.setAttribute('dominant-baseline','middle');
      tx.setAttribute('transform','rotate(90,'+x+','+y+')');
      tx.textContent = d.name+' '+Math.round(pct*100)+'%';
      svg.appendChild(tx);
    }
  });
  if (leg) {
    leg.innerHTML = data.map(function(d,i) {
      var col = PIE_COLORS[i % PIE_COLORS.length];
      return '<span style="font-size:11px;font-weight:700;color:'+col+';display:inline-flex;align-items:center;gap:4px;">'
        +'<span style="width:8px;height:8px;border-radius:50%;background:'+col+';display:inline-block;flex-shrink:0;"></span>'
        +d.name+': $'+Number(d.amount).toLocaleString()+'</span>';
    }).join('');
  }
}

// â”€â”€ Radar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawRadar() {
  var svg = document.getElementById('radarSvg');
  if (!svg) return;
  svg.innerHTML = '';
  var keys = ['wealth','health','growth','discipline','experience'];
  var lbls = ['è²¡å‹™','å¥åº·','æˆé•·','è‡ªå¾‹','é«”é©—'];
  var C=100, R=64;
  function pt(i,v) {
    var a = Math.PI*2*i/5 - Math.PI/2;
    return [C+R*(v/100)*Math.cos(a), C+R*(v/100)*Math.sin(a)];
  }
  // Grid rings
  [20,40,60,80,100].forEach(function(v) {
    var el = document.createElementNS('http://www.w3.org/2000/svg','polygon');
    el.setAttribute('points', keys.map(function(_,j){return pt(j,v).join(',');}).join(' '));
    el.setAttribute('fill','none'); el.setAttribute('stroke','#1e293b'); el.setAttribute('stroke-width','0.8');
    svg.appendChild(el);
  });
  // Axes
  keys.forEach(function(_,i) {
    var p = pt(i,100);
    var el = document.createElementNS('http://www.w3.org/2000/svg','line');
    el.setAttribute('x1',C); el.setAttribute('y1',C); el.setAttribute('x2',p[0]); el.setAttribute('y2',p[1]);
    el.setAttribute('stroke','#1e293b'); el.setAttribute('stroke-width','0.8');
    svg.appendChild(el);
  });
  // Data
  var poly = document.createElementNS('http://www.w3.org/2000/svg','polygon');
  poly.setAttribute('points', keys.map(function(k,i){return pt(i,radarVals[k]||50).join(',');}).join(' '));
  poly.setAttribute('fill','rgba(59,130,246,0.18)'); poly.setAttribute('stroke','#3b82f6');
  poly.setAttribute('stroke-width','2'); poly.setAttribute('stroke-linejoin','round');
  svg.appendChild(poly);
  // Dots
  keys.forEach(function(k,i) {
    var p = pt(i,radarVals[k]||50);
    var el = document.createElementNS('http://www.w3.org/2000/svg','circle');
    el.setAttribute('cx',p[0]); el.setAttribute('cy',p[1]); el.setAttribute('r','3.5');
    el.setAttribute('fill','#3b82f6');
    svg.appendChild(el);
  });
  // Labels
  lbls.forEach(function(l,i) {
    var p = pt(i,120);
    var el = document.createElementNS('http://www.w3.org/2000/svg','text');
    el.setAttribute('x',p[0]); el.setAttribute('y',p[1]);
    el.setAttribute('fill','#64748b'); el.setAttribute('font-size','10');
    el.setAttribute('font-weight','bold'); el.setAttribute('text-anchor','middle');
    el.setAttribute('dominant-baseline','middle');
    el.textContent = l;
    svg.appendChild(el);
  });
}

// â”€â”€ Health chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawHealthChart() {
  var el = document.getElementById('healthChart');
  if (!el) return;
  var data = DB.health_logs || [];
  if (data.length < 2) { el.innerHTML = '<p class="empty-msg">è«‹æ–°å¢è‡³å°‘å…©ç­†è³‡æ–™ä»¥é¡¯ç¤ºè¶¨å‹¢åœ–</p>'; return; }
  var W=360,H=140,P=22;
  var keys=['weight','fat','muscle'],cols=['#3b82f6','#ef4444','#10b981'],lbls=['é«”é‡','é«”è„‚','è‚Œè‚‰'];
  function gPts(k) {
    var vals=data.map(function(d){return parseFloat(d[k])||0;});
    var mn=Math.min.apply(null,vals),mx=Math.max.apply(null,vals),rng=mx===mn?1:mx-mn;
    return data.map(function(d,i){
      return {x:P+(i/(data.length-1))*(W-2*P), y:(H-P)-((parseFloat(d[k])||0)-mn)/rng*(H-2*P)};
    });
  }
  var svg='';
  keys.forEach(function(k,i){
    var pts=gPts(k);
    svg+='<polyline fill="none" stroke="'+cols[i]+'" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" points="'+pts.map(function(p){return p.x+','+p.y;}).join(' ')+'"/>';
    pts.forEach(function(p){svg+='<circle cx="'+p.x+'" cy="'+p.y+'" r="4" fill="'+cols[i]+'" stroke="#020617" stroke-width="1.5"/>';});
  });
  var leg=lbls.map(function(l,i){
    return '<span style="font-size:11px;color:'+cols[i]+';font-weight:900;display:inline-flex;align-items:center;gap:4px;">'
      +'<span style="width:12px;height:3px;background:'+cols[i]+';border-radius:2px;display:inline-block;"></span>'+l+'</span>';
  }).join('');
  el.innerHTML='<div style="background:rgba(2,6,23,.4);padding:12px;border-radius:11px;border:1px solid #1e293b;">'
    +'<svg viewBox="0 0 '+W+' '+H+'" style="width:100%;height:120px;overflow:visible;">'+svg+'</svg>'
    +'<div style="display:flex;gap:16px;justify-content:center;margin-top:8px;">'+leg+'</div></div>';
}

// â”€â”€ Render helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderDashStats() {
  var t = total();
  var ef=document.getElementById('emergencyDisplay'),dt=document.getElementById('dashTotal'),at=document.getElementById('assetTotal');
  if(ef) ef.textContent='$'+Number(DB.emergencyFund||0).toLocaleString();
  if(dt) dt.textContent='$'+t.toLocaleString();
  if(at) at.textContent='$'+t.toLocaleString();
}

function renderDashYearly() {
  var el=document.getElementById('dash-yearly');
  if(!el) return;
  var items=(DB.plans_yearly||[]).slice(0,5);
  if(!items.length){el.innerHTML='<p class="empty-msg">å°šç„¡è¨ˆç•«ï¼Œå‰å¾€ã€Œè¨ˆç•«ã€é æ–°å¢</p>';return;}
  el.innerHTML=items.map(function(p){
    return '<div style="margin-bottom:12px;">'
      +'<div style="display:flex;justify-content:space-between;font-size:13px;font-weight:700;font-style:italic;margin-bottom:4px;">'
      +'<span>'+esc(p.title)+'</span><span style="color:#60a5fa;">'+(p.progress||0)+'%</span></div>'
      +'<div class="prog-bar"><div class="prog-fill" style="width:'+(p.progress||0)+'%;"></div></div></div>';
  }).join('');
}

function renderYearly() {
  var el=document.getElementById('yearlyList');
  if(!el) return;
  var items=DB.plans_yearly||[];
  if(!items.length){el.innerHTML='<p class="empty-msg">å°šç„¡é …ç›®ï¼Œé»æ“Š + æ–°å¢</p>';return;}
  el.innerHTML=items.map(function(item,idx){
    return '<div class="drag-item" draggable="true" data-col="plans_yearly" data-idx="'+idx+'" data-id="'+item.id+'">'
      +'<span style="color:#475569;cursor:grab;flex-shrink:0;"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="12" r="1"/><circle cx="9" cy="5" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="19" r="1"/></svg></span>'
      +'<div style="flex:1;min-width:0;"><p style="font-size:14px;font-weight:900;font-style:italic;color:#e2e8f0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">'+esc(item.title)+'</p></div>'
      +'<input type="number" min="0" max="100" value="'+(item.progress||0)+'" class="prog-input" data-type="prog" data-col="plans_yearly" data-id="'+item.id+'">'
      +'<button class="btn-del" data-type="del" data-col="plans_yearly" data-id="'+item.id+'"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>'
      +'</div>';
  }).join('');
  bindList(el);
}

function renderDaily() {
  var el=document.getElementById('dailyList');
  if(!el) return;
  var items=DB.plans_daily||[];
  if(!items.length){el.innerHTML='<p class="empty-msg">å°šç„¡é …ç›®ï¼Œé»æ“Š + æ–°å¢</p>';return;}
  el.innerHTML=items.map(function(item,idx){
    return '<div class="drag-item" draggable="true" data-col="plans_daily" data-idx="'+idx+'" data-id="'+item.id+'">'
      +'<span style="color:#475569;cursor:grab;flex-shrink:0;"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="12" r="1"/><circle cx="9" cy="5" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="19" r="1"/></svg></span>'
      +'<div style="flex:1;min-width:0;"><p style="font-size:14px;font-weight:900;font-style:italic;color:#e2e8f0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">'+esc(item.title)+'</p></div>'
      +'<button class="btn-del" data-type="del" data-col="plans_daily" data-id="'+item.id+'"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>'
      +'</div>';
  }).join('');
  bindList(el);
}

function renderAssets() {
  var el=document.getElementById('assetList');
  if(!el) return;
  var items=DB.assets||[];
  if(!items.length){el.innerHTML='<p class="empty-msg">å°šç„¡è³‡ç”¢</p>';return;}
  el.innerHTML=items.map(function(a){
    return '<div class="asset-item">'
      +'<div style="flex:1;min-width:0;padding-right:9px;">'
      +'<div style="font-size:13px;font-weight:900;color:#e2e8f0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">'+esc(a.name)+'</div>'
      +'<div style="display:flex;gap:7px;margin-top:3px;align-items:center;">'
      +'<span style="font-size:10px;color:#64748b;font-weight:900;text-transform:uppercase;">'+esc(a.category)+'</span>'
      +'<span style="font-size:14px;font-weight:900;color:#60a5fa;font-style:italic;">$'+Number(a.amount).toLocaleString()+'</span>'
      +'</div></div>'
      +'<div style="display:flex;gap:2px;flex-shrink:0;">'
      +'<button class="btn-edit" data-type="edit-asset" data-id="'+a.id+'"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button>'
      +'<button class="btn-del" data-type="del" data-col="assets" data-id="'+a.id+'"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>'
      +'</div></div>';
  }).join('');
  bindList(el);
}

function renderHealthLogs() {
  var el=document.getElementById('healthLogs');
  if(!el) return;
  var logs=(DB.health_logs||[]).slice().reverse().slice(0,10);
  if(!logs.length){el.innerHTML='<p class="empty-msg">å°šç„¡è¨˜éŒ„</p>';return;}
  el.innerHTML=logs.map(function(l){
    return '<div style="display:flex;justify-content:space-between;align-items:center;padding:10px 13px;background:rgba(30,41,59,.2);border-radius:10px;margin-bottom:7px;border:1px solid #1e293b;gap:8px;">'
      +'<span style="font-size:11px;color:#64748b;flex-shrink:0;">'+new Date(l.createdAt).toLocaleDateString('zh-TW')+'</span>'
      +'<div style="display:flex;gap:9px;flex-wrap:wrap;flex:1;">'
      +(l.weight?'<span style="font-size:12px;color:#3b82f6;font-weight:900;">é«”é‡ '+l.weight+'kg</span>':'')
      +(l.fat?'<span style="font-size:12px;color:#ef4444;font-weight:900;">é«”è„‚ '+l.fat+'%</span>':'')
      +(l.muscle?'<span style="font-size:12px;color:#10b981;font-weight:900;">è‚Œè‚‰ '+l.muscle+'kg</span>':'')
      +'</div>'
      +'<button class="btn-del" data-type="del" data-col="health_logs" data-id="'+l.id+'"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>'
      +'</div>';
  }).join('');
  bindList(el);
}

function renderNotes(key) {
  var el=document.getElementById('notes-'+key);
  if(!el) return;
  var items=DB['notes_'+key]||[];
  if(!items.length){el.innerHTML='<p class="empty-msg">å°šç„¡ç­†è¨˜</p>';return;}
  el.innerHTML=items.map(function(n){
    return '<div class="note-card">'
      +'<button class="note-hdr" data-type="note-toggle" data-nid="'+n.id+'" data-nkey="'+key+'">'
      +'<span style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;padding-right:8px;">'+esc(n.title)+'</span>'
      +'<span id="nc-'+key+'-'+n.id+'" style="color:#475569;flex-shrink:0;font-style:normal;">â–¾</span>'
      +'</button>'
      +'<div id="nb-'+key+'-'+n.id+'" class="note-body">'
      +'<p style="white-space:pre-wrap;margin-bottom:11px;">'+esc(n.content||'')+'</p>'
      +'<div style="display:flex;justify-content:flex-end;gap:12px;">'
      +'<button class="btn-sm-blue" data-type="edit-note" data-nkey="'+key+'" data-nid="'+n.id+'">ç·¨è¼¯</button>'
      +'<button class="btn-sm-red" data-type="del" data-col="notes_'+key+'" data-id="'+n.id+'">åˆªé™¤</button>'
      +'</div></div></div>';
  }).join('');
  bindList(el);
}

function renderTravel() {
  var el=document.getElementById('travelList');
  if(!el) return;
  var items=DB.travel||[];
  if(!items.length){el.innerHTML='<p class="empty-msg">å°šç„¡è¡Œç¨‹ï¼Œé»æ“Š + æ–°å¢</p>';return;}
  el.innerHTML=items.map(function(t){
    return '<div class="travel-card">'
      +'<div style="display:flex;align-items:center;gap:12px;">'
      +'<div class="travel-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg></div>'
      +'<div><p style="font-size:14px;font-weight:900;font-style:italic;color:#fff;">'+esc(t.destination)+'</p>'
      +'<p style="font-size:11px;color:#64748b;font-weight:700;margin-top:3px;">'+esc(t.start)+' ï½ '+esc(t.end)+'</p></div>'
      +'</div>'
      +'<button class="btn-del" data-type="del" data-col="travel" data-id="'+t.id+'"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>'
      +'</div>';
  }).join('');
  bindList(el);
}

function renderAll() {
  drawRadar(); drawPie('pieSvgDash','pieLegDash'); drawPie('pieSvgAsset','pieLegAsset');
  renderDashStats(); renderDashYearly();
  renderYearly(); renderDaily();
  renderAssets(); renderHealthLogs(); drawHealthChart();
  NOTE_KEYS.forEach(renderNotes);
  renderTravel();
}

// â”€â”€ Event delegation per container â”€â”€â”€â”€â”€â”€
// Using a single delegated handler per rendered container
// avoids re-binding issues and is the most Safari-reliable pattern
function bindList(container) {
  // Remove old listener by replacing with clone
  var newEl = container.cloneNode(true);
  container.parentNode.replaceChild(newEl, container);
  newEl.addEventListener('click', function(e) {
    var target = e.target;
    // Walk up to find data-type
    while (target && target !== newEl) {
      var type = target.getAttribute('data-type');
      if (type) { handleListClick(type, target, e); return; }
      target = target.parentNode;
    }
  });
}

function handleListClick(type, el, e) {
  if (type === 'del') {
    var col = el.getAttribute('data-col');
    var id = el.getAttribute('data-id');
    if (!DB[col]) return;
    DB[col] = DB[col].filter(function(x) { return x.id !== id; });
    dbSave(DB); renderAll();
  } else if (type === 'prog') {
    // handled on change, not click
  } else if (type === 'edit-asset') {
    var id = el.getAttribute('data-id');
    openModal('assets','edit','ç·¨è¼¯è³‡ç”¢',[
      {name:'name',label:'åç¨±',type:'text'},
      {name:'amount',label:'å¸‚å€¼é‡‘é¡',type:'number'},
      {name:'category',label:'åˆ†é¡',type:'text'}
    ], id);
  } else if (type === 'note-toggle') {
    var nid = el.getAttribute('data-nid');
    var nkey = el.getAttribute('data-nkey');
    var body = document.getElementById('nb-'+nkey+'-'+nid);
    var chev = document.getElementById('nc-'+nkey+'-'+nid);
    if (!body) return;
    var open = body.className === 'note-body open';
    body.className = open ? 'note-body' : 'note-body open';
    if (chev) chev.textContent = open ? 'â–¾' : 'â–´';
  } else if (type === 'edit-note') {
    var nkey = el.getAttribute('data-nkey');
    var nid = el.getAttribute('data-nid');
    openModal('notes_'+nkey,'edit','ç·¨è¼¯ç­†è¨˜',[
      {name:'title',label:'æ¨™é¡Œ',type:'text'},
      {name:'content',label:'å…§å®¹',type:'textarea'}
    ], nid);
  }
}

// Also bind change event for progress inputs (separate from click)
function bindProgInputs() {
  var inputs = document.querySelectorAll('[data-type="prog"]');
  for (var i=0; i<inputs.length; i++) {
    (function(inp) {
      inp.addEventListener('change', function() {
        var col=inp.getAttribute('data-col'), id=inp.getAttribute('data-id');
        var v=Math.min(100,Math.max(0,parseInt(inp.value)||0));
        if(!DB[col]) return;
        DB[col]=DB[col].map(function(x){ return x.id===id ? Object.assign({},x,{progress:v}) : x; });
        dbSave(DB); renderAll();
      });
    })(inputs[i]);
  }
}

// â”€â”€ Drag & Drop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initDrag(container, col) {
  var items = container.querySelectorAll('[data-col="'+col+'"]');
  for (var i=0; i<items.length; i++) {
    (function(item) {
      item.addEventListener('dragstart', function(e) { dragSrc=item; e.dataTransfer.effectAllowed='move'; });
      item.addEventListener('dragover', function(e) { e.preventDefault(); item.className='drag-item drag-over'; });
      item.addEventListener('dragleave', function() { item.className='drag-item'; });
      item.addEventListener('dragend', function() { item.className='drag-item'; });
      item.addEventListener('drop', function(e) {
        e.preventDefault(); item.className='drag-item';
        if(!dragSrc||dragSrc===item) return;
        var fi=parseInt(dragSrc.getAttribute('data-idx')), ti=parseInt(item.getAttribute('data-idx'));
        var arr=(DB[col]||[]).slice(), rm=arr.splice(fi,1);
        arr.splice(ti,0,rm[0]); DB[col]=arr; dbSave(DB); renderAll();
      });
    })(items[i]);
  }
}

// â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(col, type, title, fields, editId) {
  mMeta = {col:col, type:type, fields:fields, editId:editId};
  document.getElementById('modalTitle').textContent = title;
  var fd = document.getElementById('modalFields');
  var init = {};
  if (type==='edit' && editId && col!=='emergency_fund') {
    var arr = DB[col]||[];
    for (var i=0; i<arr.length; i++) { if(arr[i].id===editId){init=arr[i];break;} }
  }
  if (col==='emergency_fund') init={value:DB.emergencyFund||0};
  fd.innerHTML = fields.map(function(f) {
    var v = esc(String(init[f.name]==null?'':init[f.name]));
    return '<div class="form-group"><label>'+f.label+'</label>'
      +(f.type==='textarea'?'<textarea name="'+f.name+'">'+v+'</textarea>':'<input name="'+f.name+'" type="'+f.type+'" step="any" value="'+v+'">')

```
  +'</div>';
```

}).join(â€™â€™);
document.getElementById(â€˜modalWrapâ€™).className = â€˜modal-wrap openâ€™;
}

function closeModal() {
document.getElementById(â€˜modalWrapâ€™).className = â€˜modal-wrapâ€™;
}

document.getElementById(â€˜closeModalBtnâ€™).addEventListener(â€˜clickâ€™, closeModal);
document.getElementById(â€˜modalBgâ€™).addEventListener(â€˜clickâ€™, closeModal);
document.getElementById(â€˜modalFormâ€™).addEventListener(â€˜submitâ€™, function(e) {
e.preventDefault();
var data={}, fd=new FormData(e.target);
fd.forEach(function(v,k){data[k]=v;});
var col=mMeta.col, type=mMeta.type, eid=mMeta.editId;
if (col===â€˜emergency_fundâ€™) {
DB.emergencyFund=Number(data.value);
} else if (type===â€˜editâ€™) {
DB[col]=(DB[col]||[]).map(function(x){ return x.id===eid?Object.assign({},x,data):x; });
} else {
if(!DB[col]) DB[col]=[];
DB[col].push(Object.assign({id:uid(),createdAt:Date.now()},data));
}
dbSave(DB); closeModal(); renderAll();
});

// â”€â”€ Static button bindings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var btnMap = [
[â€˜aiBtnâ€™,        function(){generateAI();}],
[â€˜assetAiBtnâ€™,   function(){getAssetAI();}],
[â€˜voiceBtnâ€™,     function(){handleVoice();}],
[â€˜emergencyBtnâ€™, function(){openModal(â€˜emergency_fundâ€™,â€˜editâ€™,â€˜ä¿®æ”¹ç·Šæ€¥é å‚™é‡‘â€™,[{name:â€˜valueâ€™,label:â€˜é‡‘é¡â€™,type:â€˜numberâ€™}]);}],
[â€˜addYearlyBtnâ€™, function(){openModal(â€˜plans_yearlyâ€™,â€˜addâ€™,â€˜æ–°å¢å¹´åº¦è¨ˆç•«â€™,[{name:â€˜titleâ€™,label:â€˜ç›®æ¨™åç¨±â€™,type:â€˜textâ€™},{name:â€˜progressâ€™,label:â€˜ç›®å‰é€²åº¦(%)â€™,type:â€˜numberâ€™}]);}],
[â€˜addDailyBtnâ€™,  function(){openModal(â€˜plans_dailyâ€™,â€˜addâ€™,â€˜æ–°å¢æ¯æ—¥ä»»å‹™â€™,[{name:â€˜titleâ€™,label:â€˜ä»»å‹™å…§å®¹â€™,type:â€˜textâ€™}]);}],
[â€˜addHealthBtnâ€™, function(){openModal(â€˜health_logsâ€™,â€˜addâ€™,â€˜è¨˜éŒ„ä»Šæ—¥æ•¸æ“šâ€™,[{name:â€˜weightâ€™,label:â€˜é«”é‡(kg)â€™,type:â€˜numberâ€™},{name:â€˜fatâ€™,label:â€˜é«”è„‚(%)â€™,type:â€˜numberâ€™},{name:â€˜muscleâ€™,label:â€˜è‚Œè‚‰é‡(kg)â€™,type:â€˜numberâ€™}]);}],
[â€˜addAssetBtnâ€™,  function(){openModal(â€˜assetsâ€™,â€˜addâ€™,â€˜æ–°å¢è³‡ç”¢â€™,[{name:â€˜nameâ€™,label:â€˜åç¨±â€™,type:â€˜textâ€™},{name:â€˜amountâ€™,label:â€˜å¸‚å€¼é‡‘é¡â€™,type:â€˜numberâ€™},{name:â€˜categoryâ€™,label:â€˜åˆ†é¡(å°è‚¡/ç¾è‚¡/ç¾é‡‘/é»ƒé‡‘/å€Ÿæ¬¾)â€™,type:â€˜textâ€™}]);}],
[â€˜addNoteLifeBtnâ€™,    function(){openModal(â€˜notes_lifeâ€™,â€˜addâ€™,â€˜æ–°å¢äººç”Ÿæˆé•·â€™,[{name:â€˜titleâ€™,label:â€˜æ¨™é¡Œâ€™,type:â€˜textâ€™},{name:â€˜contentâ€™,label:â€˜å…§å®¹â€™,type:â€˜textareaâ€™}]);}],
[â€˜addNoteBookBtnâ€™,    function(){openModal(â€˜notes_bookâ€™,â€˜addâ€™,â€˜æ–°å¢æ›¸ç±é‡é»â€™,[{name:â€˜titleâ€™,label:â€˜æ¨™é¡Œâ€™,type:â€˜textâ€™},{name:â€˜contentâ€™,label:â€˜å…§å®¹â€™,type:â€˜textareaâ€™}]);}],
[â€˜addNoteTradingBtnâ€™, function(){openModal(â€˜notes_tradingâ€™,â€˜addâ€™,â€˜æ–°å¢å°æŒ‡äº¤æ˜“â€™,[{name:â€˜titleâ€™,label:â€˜æ¨™é¡Œâ€™,type:â€˜textâ€™},{name:â€˜contentâ€™,label:â€˜å…§å®¹â€™,type:â€˜textareaâ€™}]);}],
[â€˜addNoteWebBtnâ€™,     function(){openModal(â€˜notes_webâ€™,â€˜addâ€™,â€˜æ–°å¢ç¶²è·¯å¿ƒå¾—â€™,[{name:â€˜titleâ€™,label:â€˜æ¨™é¡Œâ€™,type:â€˜textâ€™},{name:â€˜contentâ€™,label:â€˜å…§å®¹â€™,type:â€˜textareaâ€™}]);}],
[â€˜addTravelBtnâ€™, function(){openModal(â€˜travelâ€™,â€˜addâ€™,â€˜æ–°å¢æ—…éŠè¡Œç¨‹â€™,[{name:â€˜destinationâ€™,label:â€˜ç›®çš„åœ°â€™,type:â€˜textâ€™},{name:â€˜startâ€™,label:â€˜é–‹å§‹æ—¥æœŸâ€™,type:â€˜dateâ€™},{name:â€˜endâ€™,label:â€˜çµæŸæ—¥æœŸâ€™,type:â€˜dateâ€™}]);}]
];
btnMap.forEach(function(pair) {
var el=document.getElementById(pair[0]);
if(el) el.addEventListener(â€˜clickâ€™, pair[1]);
});

// â”€â”€ AI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function callAI(prompt, asJson) {
var url=â€˜https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=â€™+GK;
var body={contents:[{parts:[{text:prompt}]}]};
if(asJson) body.generationConfig={responseMimeType:â€˜application/jsonâ€™};
return fetch(url,{method:â€˜POSTâ€™,headers:{â€˜Content-Typeâ€™:â€˜application/jsonâ€™},body:JSON.stringify(body)})
.then(function(r){return r.json();})
.then(function(d){
return d&&d.candidates&&d.candidates[0]&&d.candidates[0].content&&
d.candidates[0].content.parts&&d.candidates[0].content.parts[0]?
d.candidates[0].content.parts[0].text : â€˜â€™;
});
}

function generateAI() {
if(aiRunning) return;
aiRunning=true;
var btn=document.getElementById(â€˜aiBtnâ€™), sum=document.getElementById(â€˜aiSummaryâ€™);
if(btn) btn.textContent=â€˜é‹ç®—ä¸­â€¦â€™;
var ctx=â€˜è³‡ç”¢ç¸½é¡ï¼šâ€™+total().toLocaleString()+â€˜å…ƒï¼Œé…ç½®ï¼šâ€™+JSON.stringify(catData());
Promise.all([
callAI(â€˜åˆ†æäººç”Ÿæ•¸æ“šï¼Œå°è²¡å‹™ã€å¥åº·ã€è‡ªæˆ‘æˆé•·ã€åŸ·è¡ŒåŠ›ã€ç”Ÿæ´»é«”é©—å„è©•0-100åˆ†ï¼Œåªå›å‚³JSONï¼š{â€œwealthâ€:N,â€œhealthâ€:N,â€œgrowthâ€:N,â€œdisciplineâ€:N,â€œexperienceâ€:N}ã€‚è³‡æ–™ï¼šâ€™+ctx, true),
callAI(â€˜æ ¹æ“šè³‡æ–™ï¼šâ€™+ctx+â€™ï¼Œç”¨ç¹é«”ä¸­æ–‡ç´„150å­—çµ¦å‡ºäººç”Ÿæˆé•·èˆ‡ç†è²¡å»ºè­°ã€‚â€™, false)
]).then(function(res) {
try{ if(res[0]) radarVals=JSON.parse(res[0]); }catch(e){}
if(sum) sum.textContent=res[1]||â€˜AI åˆ†æå®Œæˆã€‚â€™;
drawRadar();
}).catch(function(){
if(sum) sum.textContent=â€˜AI åˆ†ææš«æ™‚ç„¡æ³•ä½¿ç”¨ï¼Œè«‹ç¢ºèªç¶²è·¯é€£ç·šã€‚â€™;
}).then(function(){ aiRunning=false; if(btn) btn.textContent=â€˜é‡æ–°ç”¢ç”Ÿâ€™; });
}

function getAssetAI() {
if(aiRunning) return;
aiRunning=true;
var btn=document.getElementById(â€˜assetAiBtnâ€™), adv=document.getElementById(â€˜assetAdviceâ€™);
if(btn) btn.textContent=â€˜åˆ†æä¸­â€¦â€™;
callAI(â€˜åˆ†æè³‡ç”¢é…ç½®ï¼šâ€™+JSON.stringify(catData())+â€™ï¼Œç”¨ç¹é«”ä¸­æ–‡ç´„100å­—çµ¦å‡ºå…·é«”å„ªåŒ–å»ºè­°ã€‚â€™,false)
.then(function(r){ if(adv) adv.textContent=r||â€˜åˆ†æå®Œæˆã€‚â€™; })
.catch(function(){ if(adv) adv.textContent=â€˜AI åˆ†ææš«æ™‚ç„¡æ³•ä½¿ç”¨ã€‚â€™; })
.then(function(){ aiRunning=false; if(btn) btn.textContent=â€˜é–‹å§‹åˆ†æâ€™; });
}

function handleVoice() {
var SR=window.SpeechRecognition||window.webkitSpeechRecognition;
var btn=document.getElementById(â€˜voiceBtnâ€™);
if(!SR){ alert(â€˜èªéŸ³è¼¸å…¥éœ€è¦å…è¨±éº¥å…‹é¢¨ï¼Œæˆ–ä½¿ç”¨ Chrome ç€è¦½å™¨ã€‚â€™); return; }
var rec=new SR(); rec.lang=â€˜zh-TWâ€™; rec.start();
if(btn) btn.className=â€˜voice-btn listeningâ€™;
rec.onresult=function(ev){
var t=ev.results[0][0].transcript;
if(btn) btn.className=â€˜voice-btnâ€™;
callAI(â€˜è§£æèªå¥ï¼Œèªå¥ï¼šã€Œâ€™+t+â€™ã€ï¼Œåªå›å‚³JSONï¼š{â€œtypeâ€:â€œhealth_logsâ€,â€œdataâ€:{â€œweightâ€:æ•¸å­—æˆ–null,â€œfatâ€:æ•¸å­—æˆ–null,â€œmuscleâ€:æ•¸å­—æˆ–null}}â€™,true)
.then(function(r){
try{
var p=JSON.parse(r);
if(!DB[p.type]) DB[p.type]=[];
DB[p.type].push(Object.assign({id:uid(),createdAt:Date.now()},p.data));
dbSave(DB); renderAll();
}catch(e){}
});
};
rec.onerror=function(){ if(btn) btn.className=â€˜voice-btnâ€™; };
}

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
renderAll();
</script>

</body>
</html>
